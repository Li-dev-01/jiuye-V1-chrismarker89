<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é—®å·2è°ƒè¯•æµ‹è¯•</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .info { background-color: #d1ecf1; border-color: #bee5eb; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 3px; overflow-x: auto; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 3px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ” é—®å·2è°ƒè¯•æµ‹è¯•é¡µé¢</h1>
    
    <div class="section info">
        <h3>ğŸ“‹ æµ‹è¯•è¯´æ˜</h3>
        <p>è¿™ä¸ªé¡µé¢ç”¨äºæµ‹è¯•é—®å·2çš„APIè¿æ¥å’Œæ•°æ®ç»“æ„ï¼ŒéªŒè¯ä¿®å¤æ•ˆæœã€‚</p>
        <p><strong>é¢„æœŸç»“æœï¼š</strong></p>
        <ul>
            <li>âœ… åˆå§‹æ˜¾ç¤º4ä¸ªæ— æ¡ä»¶ç« èŠ‚ï¼ˆåŸºæœ¬ä¿¡æ¯ã€å½“å‰çŠ¶æ€ã€ç»æµå‹åŠ›ã€å°±ä¸šä¿¡å¿ƒï¼‰</li>
            <li>âœ… æ€»å…±8ä¸ªé—®é¢˜ç«‹å³å¯è§</li>
            <li>âœ… å›ç­”"å…¨èŒå·¥ä½œ"åæ˜¾ç¤ºç¬¬5ä¸ªç« èŠ‚ï¼ˆæ”¶å…¥çŠ¶å†µï¼‰ï¼Œå¢åŠ 2ä¸ªé—®é¢˜</li>
            <li>âœ… æœ€ç»ˆæ€»å…±10ä¸ªé—®é¢˜</li>
        </ul>
    </div>

    <div class="section">
        <h3>ğŸ”— APIè¿æ¥æµ‹è¯•</h3>
        <button onclick="testAPI()">æµ‹è¯•APIè¿æ¥</button>
        <div id="api-result"></div>
    </div>

    <div class="section">
        <h3>ğŸ“Š ç« èŠ‚ç»“æ„åˆ†æ</h3>
        <button onclick="analyzeSections()">åˆ†æç« èŠ‚ç»“æ„</button>
        <div id="sections-result"></div>
    </div>

    <div class="section">
        <h3>ğŸ”€ æ¡ä»¶é€»è¾‘æµ‹è¯•</h3>
        <button onclick="testConditions()">æµ‹è¯•æ¡ä»¶é€»è¾‘</button>
        <div id="conditions-result"></div>
    </div>

    <div class="section">
        <h3>ğŸš€ å¿«é€Ÿè®¿é—®</h3>
        <button onclick="openQuestionnaire()">æ‰“å¼€é—®å·2</button>
        <button onclick="openConsole()">æŸ¥çœ‹æµè§ˆå™¨æ§åˆ¶å°</button>
    </div>

    <script>
        async function testAPI() {
            const resultDiv = document.getElementById('api-result');
            resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨æµ‹è¯•APIè¿æ¥...</p>';
            
            try {
                const response = await fetch('http://localhost:8787/api/universal-questionnaire/questionnaires/questionnaire-v2-2024');
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>âœ… APIè¿æ¥æˆåŠŸ</h4>
                            <p><strong>é—®å·æ ‡é¢˜ï¼š</strong>${data.data.title}</p>
                            <p><strong>ç« èŠ‚æ•°é‡ï¼š</strong>${data.data.sections.length}</p>
                            <p><strong>é—®å·IDï¼š</strong>${data.data.id}</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error"><h4>âŒ APIè¿”å›é”™è¯¯</h4><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><h4>âŒ APIè¿æ¥å¤±è´¥</h4><p>${error.message}</p></div>`;
            }
        }

        async function analyzeSections() {
            const resultDiv = document.getElementById('sections-result');
            resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨åˆ†æç« èŠ‚ç»“æ„...</p>';
            
            try {
                const response = await fetch('http://localhost:8787/api/universal-questionnaire/questionnaires/questionnaire-v2-2024');
                const data = await response.json();
                
                if (data.success) {
                    const sections = data.data.sections;
                    const unconditionalSections = sections.filter(s => !s.condition);
                    const conditionalSections = sections.filter(s => s.condition);
                    const totalQuestions = sections.reduce((sum, s) => sum + s.questions.length, 0);
                    const initialQuestions = unconditionalSections.reduce((sum, s) => sum + s.questions.length, 0);
                    
                    resultDiv.innerHTML = `
                        <div class="success">
                            <h4>ğŸ“Š ç« èŠ‚ç»“æ„åˆ†æ</h4>
                            <p><strong>æ€»ç« èŠ‚æ•°ï¼š</strong>${sections.length}</p>
                            <p><strong>æ— æ¡ä»¶ç« èŠ‚ï¼š</strong>${unconditionalSections.length} ä¸ªï¼ˆç«‹å³æ˜¾ç¤ºï¼‰</p>
                            <p><strong>æ¡ä»¶ç« èŠ‚ï¼š</strong>${conditionalSections.length} ä¸ªï¼ˆéœ€æ»¡è¶³æ¡ä»¶ï¼‰</p>
                            <p><strong>æ€»é—®é¢˜æ•°ï¼š</strong>${totalQuestions} ä¸ª</p>
                            <p><strong>åˆå§‹é—®é¢˜æ•°ï¼š</strong>${initialQuestions} ä¸ª</p>
                            
                            <h5>ğŸ” æ— æ¡ä»¶ç« èŠ‚è¯¦æƒ…ï¼š</h5>
                            <ul>
                                ${unconditionalSections.map(s => `<li>${s.id}: ${s.title} (${s.questions.length}é¢˜)</li>`).join('')}
                            </ul>
                            
                            <h5>ğŸ”€ æ¡ä»¶ç« èŠ‚è¯¦æƒ…ï¼š</h5>
                            <ul>
                                ${conditionalSections.map(s => `<li>${s.id}: ${s.title} (${s.questions.length}é¢˜) - ä¾èµ–: ${s.condition.dependsOn} = ${s.condition.value}</li>`).join('')}
                            </ul>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<div class="error"><h4>âŒ æ•°æ®è·å–å¤±è´¥</h4><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><h4>âŒ åˆ†æå¤±è´¥</h4><p>${error.message}</p></div>`;
            }
        }

        async function testConditions() {
            const resultDiv = document.getElementById('conditions-result');
            resultDiv.innerHTML = '<p>ğŸ”„ æ­£åœ¨æµ‹è¯•æ¡ä»¶é€»è¾‘...</p>';
            
            try {
                const response = await fetch('http://localhost:8787/api/universal-questionnaire/questionnaires/questionnaire-v2-2024');
                const data = await response.json();
                
                if (data.success) {
                    const sections = data.data.sections;
                    const conditionalSection = sections.find(s => s.condition);
                    
                    if (conditionalSection) {
                        const condition = conditionalSection.condition;
                        const dependentSection = sections.find(s => s.id === condition.dependsOn);
                        const dependentQuestion = dependentSection ? dependentSection.questions[0] : null;
                        
                        resultDiv.innerHTML = `
                            <div class="info">
                                <h4>ğŸ”€ æ¡ä»¶é€»è¾‘åˆ†æ</h4>
                                <p><strong>æ¡ä»¶ç« èŠ‚ï¼š</strong>${conditionalSection.id} - ${conditionalSection.title}</p>
                                <p><strong>ä¾èµ–ç« èŠ‚ï¼š</strong>${condition.dependsOn}</p>
                                <p><strong>ä¾èµ–é—®é¢˜ï¼š</strong>${dependentQuestion ? dependentQuestion.id : 'æœªæ‰¾åˆ°'}</p>
                                <p><strong>è§¦å‘æ¡ä»¶ï¼š</strong>${condition.operator} "${condition.value}"</p>
                                
                                <h5>âš ï¸ æ½œåœ¨é—®é¢˜æ£€æŸ¥ï¼š</h5>
                                <ul>
                                    <li>ç« èŠ‚ID vs é—®é¢˜ID: ${condition.dependsOn} vs ${dependentQuestion ? dependentQuestion.id : 'æœªæ‰¾åˆ°'}</li>
                                    <li>IDåŒ¹é…: ${condition.dependsOn === (dependentQuestion ? dependentQuestion.id : '') ? 'âœ… åŒ¹é…' : 'âŒ ä¸åŒ¹é… - éœ€è¦æ˜ å°„'}</li>
                                </ul>
                                
                                <h5>ğŸ”§ ä¿®å¤çŠ¶æ€ï¼š</h5>
                                <p>å‰ç«¯ä»£ç å·²æ·»åŠ IDæ˜ å°„é€»è¾‘ï¼šcurrent-status-v2 â†’ current-status-question-v2</p>
                            </div>
                        `;
                    } else {
                        resultDiv.innerHTML = `<div class="info"><h4>â„¹ï¸ æ²¡æœ‰æ‰¾åˆ°æ¡ä»¶ç« èŠ‚</h4></div>`;
                    }
                } else {
                    resultDiv.innerHTML = `<div class="error"><h4>âŒ æ•°æ®è·å–å¤±è´¥</h4><pre>${JSON.stringify(data, null, 2)}</pre></div>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<div class="error"><h4>âŒ æµ‹è¯•å¤±è´¥</h4><p>${error.message}</p></div>`;
            }
        }

        function openQuestionnaire() {
            window.open('http://localhost:5173/questionnaire-v2/survey', '_blank');
        }

        function openConsole() {
            alert('è¯·æŒ‰ F12 æˆ–å³é”®é€‰æ‹©"æ£€æŸ¥å…ƒç´ "æ‰“å¼€å¼€å‘è€…å·¥å…·ï¼ŒæŸ¥çœ‹Consoleæ ‡ç­¾é¡µçš„æ—¥å¿—è¾“å‡ºã€‚');
        }

        // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨è¿è¡Œæµ‹è¯•
        window.onload = function() {
            testAPI();
        };
    </script>
</body>
</html>
