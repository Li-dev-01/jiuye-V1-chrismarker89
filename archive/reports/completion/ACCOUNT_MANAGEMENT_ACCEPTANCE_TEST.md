# 账户管理系统 - 完整验收测试清单

## 📋 测试环境

- **前端地址**：https://58a8870c.reviewer-admin-dashboard.pages.dev
- **后端地址**：https://employment-survey-api-prod.chrismarker89.workers.dev
- **测试日期**：2025-10-06

---

## ✅ 测试清单

### 1. 基础登录功能

#### 1.1 超级管理员密码登录
- [ ] 访问 `/unified-login`
- [ ] 选择"超级管理员"标签
- [ ] 输入账号：`superadmin`，密码：`admin123`
- [ ] 点击"登录"
- [ ] **预期**：成功登录，跳转到超级管理员面板

#### 1.2 Google OAuth 登录（无 2FA）
- [ ] 访问 `/unified-login`
- [ ] 选择角色（审核员/管理员）
- [ ] 点击"使用 Google 登录"
- [ ] 完成 Google 授权
- [ ] **预期**：直接登录成功（如果该账号未启用 2FA）

---

### 2. 账户管理功能

#### 2.1 查看账户列表
- [ ] 登录超级管理员
- [ ] 左侧菜单：超级管理功能 → 账户管理
- [ ] **预期**：
  - 显示所有账户列表
  - 每行显示：邮箱、角色、用户名、权限、2FA 状态、操作按钮
  - 2FA 列显示"已启用"或"未启用"（不是 "-"）

#### 2.2 添加新账户
- [ ] 点击"添加用户"按钮
- [ ] 填写表单：
  - 邮箱：`test@example.com`
  - 角色：管理员
  - 用户名：`testadmin`
  - 显示名称：`测试管理员`
  - 密码：`Test123456`
  - 权限：选择几个权限
- [ ] 点击"确定"
- [ ] **预期**：
  - 创建成功提示
  - 列表中出现新账户
  - 2FA 状态为"未启用"

#### 2.3 编辑账户
- [ ] 点击某个账户的"编辑"按钮
- [ ] 修改显示名称
- [ ] 修改权限
- [ ] 点击"确定"
- [ ] **预期**：
  - 更新成功提示
  - 列表中显示更新后的信息

#### 2.4 删除账户
- [ ] 点击某个账户的"删除"按钮
- [ ] 确认删除
- [ ] **预期**：
  - 删除成功提示
  - 列表中不再显示该账户

---

### 3. 2FA 功能

#### 3.1 启用 2FA
- [ ] 选择一个账户
- [ ] 点击"启用2FA"按钮
- [ ] **预期**：弹出模态框，显示：
  - QR 码（可扫描）
  - 密钥（可复制）
  - 10 个备用代码（8 位数字）
  - "复制所有备用代码"按钮
  - 红色警告："这些备用代码只显示一次"

#### 3.2 保存 2FA 信息
- [ ] 使用 Google Authenticator 扫描 QR 码
- [ ] 复制密钥（备用）
- [ ] 复制所有备用代码
- [ ] 保存到安全的地方
- [ ] 关闭模态框
- [ ] **预期**：
  - 列表中该账户的 2FA 状态变为"已启用"

#### 3.3 使用 TOTP 验证码登录
- [ ] 退出登录（清除 localStorage）
- [ ] 使用 Google OAuth 登录（选择已启用 2FA 的账户）
- [ ] **预期**：跳转到 `/verify-2fa` 页面
- [ ] 页面显示：
  - 邮箱和角色信息
  - 6 位验证码输入框
  - "验证并登录"按钮
  - "使用备用代码"链接
- [ ] 打开 Google Authenticator，获取 6 位验证码
- [ ] 输入验证码
- [ ] 点击"验证并登录"
- [ ] **预期**：
  - 验证成功提示
  - 自动跳转到对应仪表板
  - 可以正常使用所有功能

#### 3.4 使用备用代码登录
- [ ] 退出登录
- [ ] 使用 Google OAuth 登录
- [ ] 在 2FA 验证页面点击"使用备用代码"
- [ ] **预期**：输入框变为 8 位
- [ ] 输入之前保存的备用代码
- [ ] 点击"验证并登录"
- [ ] **预期**：
  - 验证成功
  - 登录成功
  - 该备用代码被标记为已使用

#### 3.5 验证备用代码只能使用一次
- [ ] 退出登录
- [ ] 再次使用 Google OAuth 登录
- [ ] 尝试使用相同的备用代码
- [ ] **预期**：
  - 验证失败
  - 提示"验证码错误"

#### 3.6 禁用 2FA
- [ ] 登录超级管理员
- [ ] 访问账户管理
- [ ] 选择已启用 2FA 的账户
- [ ] 点击"禁用2FA"按钮
- [ ] 确认操作
- [ ] **预期**：
  - 禁用成功提示
  - 2FA 状态变为"未启用"
  - 下次登录不需要 2FA 验证

---

### 4. 审计日志功能

#### 4.1 查看审计日志
- [ ] 左侧菜单：超级管理功能 → 审计日志
- [ ] **预期**：显示审计日志页面，包含：
  - 4 个统计卡片（总操作数、成功操作、失败操作、活跃操作者）
  - 筛选表单（操作类型、目标邮箱、操作者邮箱、日期范围）
  - 日志表格（时间、操作者、操作类型、目标、状态、详情）
  - 分页控件

#### 4.2 查看统计信息
- [ ] 查看统计卡片
- [ ] **预期**：
  - 总操作数 > 0
  - 成功操作数 > 0
  - 活跃操作者数 > 0
  - 数据准确

#### 4.3 筛选日志
- [ ] 选择操作类型："enable_2fa"
- [ ] 点击"筛选"
- [ ] **预期**：只显示启用 2FA 的日志

- [ ] 清空筛选
- [ ] 输入目标邮箱
- [ ] 点击"筛选"
- [ ] **预期**：只显示该邮箱相关的日志

- [ ] 清空筛选
- [ ] 选择日期范围（今天）
- [ ] 点击"筛选"
- [ ] **预期**：只显示今天的日志

#### 4.4 查看日志详情
- [ ] 点击某条日志的"详情"列
- [ ] **预期**：显示 JSON 格式的详细信息

#### 4.5 分页
- [ ] 如果日志超过 10 条
- [ ] 点击"下一页"
- [ ] **预期**：显示下一页的日志

---

### 5. 权限系统

#### 5.1 角色权限验证
- [ ] 创建一个审核员账号
- [ ] 使用该账号登录
- [ ] **预期**：
  - 只能看到审核员相关的菜单
  - 无法访问管理员功能
  - 无法访问超级管理员功能

- [ ] 创建一个管理员账号
- [ ] 使用该账号登录
- [ ] **预期**：
  - 可以看到审核员和管理员菜单
  - 无法访问超级管理员功能

- [ ] 使用超级管理员登录
- [ ] **预期**：
  - 可以看到所有菜单
  - 可以访问所有功能

#### 5.2 使用账号功能
- [ ] 登录超级管理员
- [ ] 访问账户管理
- [ ] 点击某个账号的"使用"按钮
- [ ] **预期**：
  - 切换成功提示
  - 页面刷新
  - 当前角色变为该账号的角色
  - 菜单和权限相应变化

---

### 6. 错误处理

#### 6.1 2FA 验证码错误
- [ ] 在 2FA 验证页面输入错误的验证码
- [ ] **预期**：
  - 验证失败提示
  - 不会登录
  - 可以重新输入

#### 6.2 会话过期
- [ ] 在 2FA 验证页面等待 10 分钟
- [ ] 输入正确的验证码
- [ ] **预期**：
  - 会话过期提示
  - 需要重新登录

#### 6.3 无效的备用代码
- [ ] 输入不存在的备用代码
- [ ] **预期**：
  - 验证失败提示

#### 6.4 未授权访问
- [ ] 退出登录
- [ ] 直接访问 `/admin/account-management`
- [ ] **预期**：
  - 重定向到登录页面

---

### 7. 数据一致性

#### 7.1 2FA 状态同步
- [ ] 启用 2FA
- [ ] 刷新页面
- [ ] **预期**：2FA 状态仍然是"已启用"

- [ ] 禁用 2FA
- [ ] 刷新页面
- [ ] **预期**：2FA 状态变为"未启用"

#### 7.2 审计日志记录
- [ ] 执行任意操作（添加、编辑、删除账户）
- [ ] 访问审计日志
- [ ] **预期**：
  - 所有操作都有日志记录
  - 日志包含完整信息（操作者、目标、时间、详情）
  - 成功/失败状态正确

#### 7.3 备用代码管理
- [ ] 启用 2FA，获取备用代码
- [ ] 使用一个备用代码登录
- [ ] 禁用 2FA
- [ ] 重新启用 2FA
- [ ] **预期**：
  - 获得新的备用代码
  - 旧的备用代码无法使用

---

### 8. 性能测试

#### 8.1 页面加载速度
- [ ] 访问账户管理页面
- [ ] **预期**：3 秒内加载完成

- [ ] 访问审计日志页面
- [ ] **预期**：3 秒内加载完成

#### 8.2 操作响应速度
- [ ] 添加账户
- [ ] **预期**：1 秒内完成

- [ ] 启用 2FA
- [ ] **预期**：2 秒内显示 QR 码

- [ ] 筛选日志
- [ ] **预期**：1 秒内显示结果

---

### 9. 兼容性测试

#### 9.1 浏览器兼容性
- [ ] Chrome 浏览器测试
- [ ] Safari 浏览器测试
- [ ] Firefox 浏览器测试
- [ ] **预期**：所有功能正常

#### 9.2 移动端兼容性
- [ ] 手机浏览器访问
- [ ] **预期**：
  - 页面自适应
  - 功能正常
  - QR 码可扫描

---

## 📊 验收标准

### 必须通过（P0）
- [ ] 所有基础登录功能正常
- [ ] 账户管理 CRUD 功能正常
- [ ] 2FA 启用/禁用功能正常
- [ ] TOTP 验证码登录正常
- [ ] 备用代码登录正常
- [ ] 审计日志记录完整
- [ ] 权限系统正确

### 应该通过（P1）
- [ ] 审计日志筛选功能正常
- [ ] 使用账号功能正常
- [ ] 错误处理友好
- [ ] 数据一致性保证

### 可以优化（P2）
- [ ] 页面加载速度优化
- [ ] 移动端体验优化
- [ ] 更多浏览器兼容性

---

## 🐛 已知问题

（在测试过程中发现的问题记录在这里）

---

## ✅ 验收结论

- [ ] **通过**：所有 P0 和 P1 测试通过
- [ ] **有条件通过**：P0 通过，P1 部分通过
- [ ] **不通过**：P0 有失败项

---

## 📝 测试人员签名

- **测试人员**：___________
- **测试日期**：___________
- **测试结果**：___________

