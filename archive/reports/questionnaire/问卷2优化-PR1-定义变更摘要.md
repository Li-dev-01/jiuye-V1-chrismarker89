# 问卷2优化 - PR1：定义变更摘要

## 📋 变更概览

**变更时间**: 2025-01-05  
**变更文件**: `backend/src/data/questionnaire2/definition.ts`  
**版本升级**: v2.0.0 → v2.1.0  
**预计完成时长**: 8分钟 → 12分钟  

---

## 🎯 优化目标

基于用户反馈，围绕"个体差异→整体画像→社会观点"三层目标，实现：

1. **补充关键基础维度**：性别、婚育、地域、工作年限等
2. **新增现实场景问题**：求职歧视类型、严重度、渠道、案例
3. **新增开放性问题**：个人优势/忧虑/期望支持
4. **增强分支逻辑**：根据性别/年龄/状态动态展示相关问题
5. **支持数据分析链路**：字段全覆盖→大表→派生表→可视化

---

## ✅ 新增内容清单

### A. 基础信息扩展（basic-demographics-v2）

新增 **7个问题**，从2个扩展到9个：

| 问题ID | 类型 | 标题 | 选项数 | 分支逻辑 |
|--------|------|------|--------|----------|
| `gender-v2` | radio | 您的性别是？ | 4 | ✅ 影响婚育/年龄歧视板块 |
| `marital-status-v2` | radio | 您的婚姻状况是？ | 5 | ✅ 影响婚育歧视板块 |
| `has-children-v2` | radio | 您是否有子女？ | 3 | ✅ 影响婚育歧视板块 |
| `fertility-intent-v2` | radio | 您是否有生育计划？ | 5 | ✅ 条件显示（女性），影响婚育歧视板块 |
| `current-city-tier-v2` | radio | 您目前所在的城市层级是？ | 7 | - |
| `hukou-type-v2` | radio | 您的户籍类型是？ | 4 | - |
| `years-experience-v2` | radio | 您的工作年限是？ | 6 | - |

**关键特性**：
- 性别问题置于首位，作为核心分支变量
- 生育计划仅对女性显示（条件逻辑）
- 所有敏感问题提供"不愿透露"选项

---

### B. 新增板块：求职歧视与现实场景（discrimination-reality-v2）

新增 **4个问题**：

| 问题ID | 类型 | 标题 | 选项数 | 特性 |
|--------|------|------|--------|------|
| `experienced-discrimination-types-v2` | checkbox | 您在求职过程中是否经历或担忧以下歧视情况？ | 14 | 核心问题 |
| `discrimination-severity-v2` | radio | 您认为这些歧视对您求职的影响程度是？ | 5 | 条件显示 |
| `discrimination-channels-v2` | checkbox | 您主要在哪些渠道或环节遇到这些歧视？ | 9 | 条件显示 |
| `discrimination-case-open-v2` | textarea | 如果您愿意，可以简要描述一次印象深刻的歧视经历 | - | 开放题，可选 |

**歧视类型覆盖**：
- 工作经验、性别、婚育、年龄、地域
- 学历层次、学校层次、专业、健康
- 外貌/身高/体重、政治面貌、家庭背景、其他

**渠道覆盖**：
- 招聘广告、在线平台、简历筛选
- 电话面试、现场面试、背景调查
- Offer阶段、内推、其他

---

### C. 新增板块：个人优势与忧虑（personal-perspective-v2）

新增 **4个问题**：

| 问题ID | 类型 | 标题 | 特性 |
|--------|------|------|------|
| `personal-advantages-v2` | textarea | 您认为自己在就业市场上的主要优势是什么？ | 开放题，300字 |
| `employment-concerns-v2` | textarea | 您当前在就业方面最主要的忧虑是什么？ | 开放题，300字 |
| `support-needed-types-v2` | checkbox | 您希望在就业方面得到哪些支持？ | 10个选项 |
| `support-needed-open-v2` | textarea | 您还希望得到哪些具体的支持或建议？ | 开放题，300字 |

**支持类型覆盖**：
- 政策支持、技能培训、职业规划、招聘信息
- 反歧视保护、心理支持、人脉资源、灵活就业
- 公平评估、其他

---

### D. 新增分支板块（条件显示）

#### D1. 年龄歧视细化（age-discrimination-detail-v2）

**条件**: `age-range-v2 = 'over-35'`  
**新增 3个问题**：

- `age-discrimination-frequency-v2`: 遇到年龄限制的频率
- `career-transition-intent-v2`: 是否考虑职业转型
- `age-advantage-perception-v2`: 年龄带来的优势

---

#### D2. 婚育歧视细化（marriage-discrimination-detail-v2）

**条件**: `gender-v2 = 'female'`  
**新增 3个问题**：

- `marriage-inquiry-frequency-v2`: 被询问婚育状况的频率
- `marriage-impact-perception-v2`: 婚育状况对求职的影响
- `employer-requirements-v2`: 遇到的婚育相关用工要求

---

#### D3. 求职细节（job-seeking-detail-v2）

**条件**: `current-status-question-v2 = 'unemployed'`  
**新增 5个问题**：

- `job-seeking-duration-v2`: 求职时长
- `applications-per-week-v2`: 每周投递简历数量
- `interview-conversion-v2`: 面试邀约率
- `channels-used-v2`: 使用的求职渠道（11个选项）
- `offer-received-v2`: 收到的offer数量

---

#### D4. 学生职业规划（student-career-planning-v2）

**条件**: `current-status-question-v2 = 'student'`  
**新增 4个问题**：

- `internship-experience-v2`: 实习经验时长
- `internship-difficulty-v2`: 找实习的难度
- `further-education-intent-v2`: 继续深造计划
- `career-preparation-v2`: 为就业做的准备（8个选项）

---

## 📊 数据统计

### 问题数量变化

| 板块 | 原有问题数 | 新增问题数 | 总计 |
|------|-----------|-----------|------|
| 基础信息 | 2 | 7 | 9 |
| 当前状态 | 1 | 0 | 1 |
| 经济压力 | 3 | 0 | 3 |
| 在职收入 | 2 | 0 | 2 |
| 就业信心 | 2 | 0 | 2 |
| **求职歧视** | 0 | 4 | 4 |
| **个人优势与忧虑** | 0 | 4 | 4 |
| **年龄歧视细化** | 0 | 3 | 3 |
| **婚育歧视细化** | 0 | 3 | 3 |
| **求职细节** | 0 | 5 | 5 |
| **学生职业规划** | 0 | 4 | 4 |
| **总计** | **10** | **30** | **40** |

### 板块数量变化

- 原有板块：5个
- 新增板块：6个
- 总计板块：11个

### 分支逻辑

| 分支触发条件 | 影响板块 | 新增问题数 |
|-------------|---------|-----------|
| 年龄 35+ | 年龄歧视细化 | 3 |
| 性别=女性 | 婚育歧视细化 | 3 |
| 状态=待业 | 求职细节 | 5 |
| 状态=学生 | 学生职业规划 | 4 |
| 性别=女性 | 生育计划问题 | 1 |

---

## 🎨 设计原则（新增）

1. **个体差异优先**：通过性别、年龄、婚育、地域等维度捕捉个体特征
2. **现实场景聚焦**：深入了解求职歧视的类型、严重度与发生渠道
3. **智能分支逻辑**：根据用户画像动态展示相关问题，减少无关题目
4. **开放性补充**：结合结构化题目与开放题，捕捉语义空白
5. **隐私保护**：敏感问题提供"不愿透露"选项，完全匿名统计

---

## 📈 数据分析能力提升

### 新增分析维度

1. **性别维度**
   - 性别×失业率
   - 性别×经济压力
   - 性别×求职周期
   - 性别×歧视类型

2. **婚育维度**
   - 婚姻状况×就业状态
   - 子女状况×求职难度
   - 生育计划×歧视频率

3. **地域维度**
   - 城市层级×就业机会
   - 户籍类型×流动意愿
   - 地域×薪资水平

4. **年龄维度**
   - 年龄×歧视频率
   - 年龄×转型意愿
   - 年龄×就业信心

5. **歧视分析**
   - 歧视类型分布
   - 歧视严重度
   - 歧视发生渠道
   - 歧视案例主题聚类（开放题）

6. **求职行为**
   - 求职时长分布
   - 投递量与转化率
   - 渠道有效性
   - Offer获取情况

---

## 🔄 数据链路支持

### 采集层（前端）
- ✅ 所有新增字段均可通过现有 `ConversationalQuestionRenderer` 渲染
- ✅ 分支逻辑由现有 `branchLogic` 机制自动处理
- ✅ 开放题支持 `textarea` 类型，带字数限制

### 存储层（后端）
- ✅ 按现有 `sectionResponses` 结构提交
- 📝 需扁平化为宽表（question_id → 列名）
- 📝 保留 `completion_path` 与 `branching_decisions` 字段

### 分析层（派生表）
- 📝 按性别/年龄/婚育/地域/状态生成聚合表
- 📝 支持交叉切片（如：女性×35+×已婚×一线城市）

### 可视化层（前端）
- 📝 更新 `questionnaire2VisualizationMapping.ts`
- 📝 扩展 `questionnaire2VisualizationService.ts`
- 📝 新增维度图表组件

---

## ⚠️ 注意事项

### 隐私与合规
- ✅ 所有敏感问题提供"不愿透露"选项
- ✅ 问卷说明中明确数据用途与匿名性
- ✅ 开放题仅用于匿名聚合分析

### 用户体验
- ✅ 分支逻辑减少无关题目，控制答题时长
- ✅ 预计完成时长：12分钟（含分支）
- ✅ 核心路径（无分支）：约8-10分钟

### 数据质量
- ✅ 必填题与可选题合理分配
- ✅ 开放题均为可选，降低弃答率
- ✅ 分支条件清晰，避免逻辑冲突

---

## 📝 下一步工作

### PR2：可视化映射与分析扩展
- [ ] 更新 `frontend/src/config/questionnaire2VisualizationMapping.ts`
- [ ] 扩展 `frontend/src/services/questionnaire2VisualizationService.ts`
- [ ] 新增维度：性别、婚育、地域、歧视
- [ ] 新增图表：性别分布、歧视类型分布、求职渠道有效性等

### PR3：端到端验收
- [ ] 前端填报测试（各分支路径）
- [ ] 数据入库验证（宽表字段完整性）
- [ ] 派生表生成验证
- [ ] 可视化展示验证
- [ ] 性能测试（12分钟完成时长）
- [ ] 隐私合规检查

---

## 🎉 总结

本次优化通过新增30个问题、6个板块、5个分支逻辑，实现了：

1. ✅ **补充关键维度**：性别、婚育、地域、工作年限
2. ✅ **聚焦现实场景**：歧视类型、严重度、渠道、案例
3. ✅ **增强分支逻辑**：根据画像动态展示，提高效率
4. ✅ **开放性补充**：优势/忧虑/支持需求
5. ✅ **支持数据分析**：字段全覆盖，支持多维切片

**核心价值**：
- 从"个体差异"到"整体画像"再到"社会观点"的完整链路
- 支持"大表→派生表→可视化"的数据分析方法论
- 兼顾数据质量、用户体验与隐私保护

---

**文档版本**: v1.0  
**创建时间**: 2025-01-05  
**作者**: Augment Agent

