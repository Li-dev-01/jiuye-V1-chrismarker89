# 问卷2优化 - PR2：可视化映射扩展摘要

## 📋 变更概览

**变更时间**: 2025-01-05  
**变更文件**: `frontend/src/config/questionnaire2VisualizationMapping.ts`  
**版本升级**: 配置版本 v2.1.0  
**依赖**: PR1（问卷定义变更）  

---

## 🎯 优化目标

扩展问卷2的可视化映射配置，支持新增的30个问题与6个板块的数据展示，实现：

1. **新增基础维度图表**：性别、婚育、地域、工作年限
2. **新增歧视分析维度**：歧视类型、严重度、渠道
3. **新增求职行为维度**：求职时长、投递量、转化率、渠道使用
4. **新增支持需求维度**：期望支持类型统计
5. **完善差异化特色标识**：标记问卷2独有的分析能力

---

## ✅ 新增内容清单

### A. 基础人口统计维度扩展

**原有问题**: 2个（年龄、学历）  
**新增问题**: 5个  
**总计问题**: 7个

| 问题ID | 图表类型 | 选项数 | 颜色方案 |
|--------|---------|--------|----------|
| `gender-v2` | pie | 4 | 蓝/粉/紫/灰 + 图标 |
| `marital-status-v2` | pie | 5 | 蓝/绿/橙/紫/灰 |
| `has-children-v2` | pie | 3 | 绿/蓝/灰 |
| `current-city-tier-v2` | bar | 7 | 渐变色谱 |
| `years-experience-v2` | bar | 6 | 红→紫渐变 |

**特性**：
- 性别图表增加图标（👨👩🧑🔒）
- 城市层级覆盖一线到农村/海外
- 工作年限采用经验梯度配色

---

### B. 新增维度：求职歧视分析（discrimination-analysis-v2）

**板块图标**: ⚖️  
**问题数量**: 3个

| 问题ID | 图表类型 | 选项数 | 核心价值 |
|--------|---------|--------|----------|
| `experienced-discrimination-types-v2` | bar | 14 | 歧视类型全景 |
| `discrimination-severity-v2` | bar | 5 | 影响程度量化 |
| `discrimination-channels-v2` | bar | 9 | 发生环节定位 |

**歧视类型覆盖**（14种）：
- 工作经验、性别、婚育、年龄、地域
- 学历层次、学校层次、专业、健康
- 外貌、政治面貌、家庭背景、其他、无

**渠道覆盖**（9种）：
- 招聘广告、在线平台、简历筛选
- 电话面试、现场面试、背景调查
- Offer阶段、内推、其他

**配色策略**：
- 歧视类型：按严重性分配（性别/婚育用红粉色系）
- 严重度：绿→黄→红渐变（无影响→极其严重）
- 渠道：按流程阶段分配

---

### C. 新增维度：支持需求分析（support-needs-analysis-v2）

**板块图标**: 🤝  
**问题数量**: 1个

| 问题ID | 图表类型 | 选项数 | 核心价值 |
|--------|---------|--------|----------|
| `support-needed-types-v2` | bar | 10 | 需求优先级排序 |

**支持类型**（10种）：
- 政策支持、技能培训、职业规划、招聘信息
- 反歧视保护、心理支持、人脉资源、灵活就业
- 公平评估、其他

**配色策略**：按支持类型分类（政策蓝、培训绿、保护红等）

---

### D. 新增维度：求职行为分析（job-seeking-behavior-v2）

**板块图标**: 🔍  
**问题数量**: 5个

| 问题ID | 图表类型 | 选项数 | 核心价值 |
|--------|---------|--------|----------|
| `job-seeking-duration-v2` | bar | 5 | 求职周期分布 |
| `applications-per-week-v2` | bar | 5 | 投递活跃度 |
| `interview-conversion-v2` | bar | 5 | 简历有效性 |
| `channels-used-v2` | bar | 11 | 渠道偏好 |
| `offer-received-v2` | bar | 5 | 求职成功率 |

**配色策略**：
- 时长/投递量/转化率：绿→红渐变（优→劣）
- 渠道：按平台类型分配（BOSS蓝、智联绿等）
- Offer数量：红→蓝渐变（0个→5+个）

**分析价值**：
- 求职周期 × 投递量 → 求职强度
- 投递量 × 转化率 → 简历质量
- 渠道使用 × Offer数量 → 渠道有效性

---

## 📊 维度统计

### 维度数量变化

| 维度 | 原有问题数 | 新增问题数 | 总计 |
|------|-----------|-----------|------|
| 基础人口统计 | 2 | 5 | 7 |
| 当前状态分析 | 1 | 0 | 1 |
| 经济压力分析 | 3 | 0 | 3 |
| 收入与工作分析 | 2 | 0 | 2 |
| 就业信心指数 | 2 | 0 | 2 |
| **求职歧视分析** | 0 | 3 | 3 |
| **支持需求分析** | 0 | 1 | 1 |
| **求职行为分析** | 0 | 5 | 5 |
| **总计** | **10** | **14** | **24** |

**说明**：
- 总计24个可视化问题（不含开放题）
- 原有6个维度 → 扩展到9个维度
- 新增维度占比：33%（3/9）

---

## 🎨 差异化特色扩展

### 原有特色（v2.0.0）

1. **经济压力分析**：现代负债类型（花呗、白条、微信分付）
2. **就业信心指数**：6个月/1年信心评估

### 新增特色（v2.1.0）

3. **求职歧视分析**
   - 14种歧视类型全景
   - 5级严重度量化
   - 9个发生渠道定位

4. **性别与婚育分析**
   - 性别分布
   - 婚姻状况 × 子女状况
   - 生育计划（女性）
   - 婚育询问频率
   - 婚育影响感知
   - 用工要求类型

5. **地域与流动分析**
   - 城市层级分布（7级）
   - 户籍类型分布

6. **求职行为分析**
   - 求职时长 × 投递量 × 转化率
   - 11种渠道使用情况
   - Offer获取分布

7. **支持需求分析**
   - 10种支持类型需求排序

8. **开放性洞察**
   - 个人优势/忧虑（文本聚类）
   - 歧视案例（主题提取）
   - 支持建议（需求挖掘）

---

## 📈 数据分析能力提升

### 单维度分析

| 维度 | 可生成图表 | 分析价值 |
|------|-----------|----------|
| 性别 | 性别分布饼图 | 性别比例、性别失衡 |
| 婚育 | 婚姻/子女分布 | 婚育状况对就业影响 |
| 地域 | 城市层级分布 | 地域就业机会差异 |
| 歧视 | 歧视类型/严重度/渠道 | 歧视全景与痛点 |
| 求职行为 | 时长/投递/转化/渠道/Offer | 求职效率与渠道有效性 |

### 交叉维度分析（示例）

| 交叉维度 | 分析指标 | 业务价值 |
|---------|---------|----------|
| 性别 × 失业率 | 男性/女性失业比例 | 性别就业差异 |
| 性别 × 歧视类型 | 女性婚育歧视占比 | 性别歧视聚焦 |
| 年龄 × 歧视频率 | 35+年龄歧视频率 | 年龄歧视量化 |
| 地域 × 薪资 | 一线/二线薪资差异 | 地域薪资梯度 |
| 婚育 × 求职周期 | 已婚/未婚求职时长 | 婚育求职难度 |
| 渠道 × Offer数量 | 各渠道有效性排序 | 渠道推荐优化 |
| 学历 × 经济压力 | 高学历/低学历压力 | 学历经济关联 |

### 多维度切片（示例）

- **女性 × 35+ × 已婚 × 一线城市**：高压力群体画像
- **男性 × 待业 × 3-6个月 × 低转化率**：求职困难群体
- **学生 × 无经验 × 实习难**：应届生痛点

---

## 🔄 数据链路支持

### 前端可视化层

**已完成**：
- ✅ 可视化映射配置（本PR）
- ✅ 维度与问题映射
- ✅ 图表类型与配色方案

**待完成**（PR3）：
- 📝 扩展 `questionnaire2VisualizationService.ts`
- 📝 实现新维度数据提取逻辑
- 📝 新增图表组件（如需）

### 后端分析层

**待完成**（PR3）：
- 📝 扩展 `/api/questionnaire-v2/analytics` 接口
- 📝 新增维度统计逻辑
- 📝 支持交叉切片查询

### 数据存储层

**待完成**（PR3）：
- 📝 宽表字段映射（question_id → 列名）
- 📝 派生表设计（按维度聚合）
- 📝 开放题文本存储与索引

---

## 🎯 配置文件变更详情

### 文件结构

```typescript
// 新增维度数量：3个
// 新增问题配置：14个
// 新增特色标识：6个
// 总行数：272 → 601（增加329行）

export const QUESTIONNAIRE2_VISUALIZATION_DIMENSIONS = [
  // 1. 基础人口统计（2→7个问题）
  // 2. 当前状态分析（1个问题）
  // 3. 经济压力分析（3个问题）
  // 4. 收入与工作分析（2个问题）
  // 5. 就业信心指数（2个问题）
  // 6. 求职歧视分析（3个问题）✨ 新增
  // 7. 支持需求分析（1个问题）✨ 新增
  // 8. 求职行为分析（5个问题）✨ 新增
];

export const QUESTIONNAIRE2_UNIQUE_FEATURES = {
  // 原有3个特色
  // 新增6个特色 ✨
};

export function getQuestionnaire2VisualizationConfig() {
  // 新增版本号、统计信息、新功能列表
}
```

### 关键变更

1. **基础人口统计维度**
   - 新增 `gender-v2`（性别）
   - 新增 `marital-status-v2`（婚姻状况）
   - 新增 `has-children-v2`（子女状况）
   - 新增 `current-city-tier-v2`（城市层级）
   - 新增 `years-experience-v2`（工作年限）

2. **新增维度：求职歧视分析**
   - `experienced-discrimination-types-v2`（14种类型）
   - `discrimination-severity-v2`（5级严重度）
   - `discrimination-channels-v2`（9个渠道）

3. **新增维度：支持需求分析**
   - `support-needed-types-v2`（10种支持）

4. **新增维度：求职行为分析**
   - `job-seeking-duration-v2`（求职时长）
   - `applications-per-week-v2`（投递量）
   - `interview-conversion-v2`（转化率）
   - `channels-used-v2`（11种渠道）
   - `offer-received-v2`（Offer数量）

5. **差异化特色扩展**
   - 新增 `discriminationAnalysis`
   - 新增 `genderAndMarriageAnalysis`
   - 新增 `regionalAnalysis`
   - 新增 `jobSeekingBehavior`
   - 新增 `supportNeeds`
   - 新增 `openEndedInsights`

---

## 📝 下一步工作（PR3）

### 前端服务扩展

- [ ] 扩展 `questionnaire2VisualizationService.ts`
  - [ ] 实现 `getDimensionData('discrimination-analysis-v2')`
  - [ ] 实现 `getDimensionData('support-needs-analysis-v2')`
  - [ ] 实现 `getDimensionData('job-seeking-behavior-v2')`
  - [ ] 扩展 `extractQuestionData` 支持新问题ID
  - [ ] 新增交叉切片查询方法

### 后端接口扩展

- [ ] 扩展 `/api/questionnaire-v2/analytics/:id` 接口
  - [ ] 新增性别/婚育/地域维度统计
  - [ ] 新增歧视类型/严重度/渠道统计
  - [ ] 新增求职行为统计
  - [ ] 支持交叉维度查询参数

### 数据库与ETL

- [ ] 宽表字段映射
  - [ ] 新增30个问题字段
  - [ ] 保留分支路径字段
- [ ] 派生表设计
  - [ ] 性别×失业率表
  - [ ] 歧视类型×严重度表
  - [ ] 渠道×有效性表
  - [ ] 地域×薪资表

### 可视化组件

- [ ] 确认现有图表组件是否满足需求
- [ ] 如需新增：
  - [ ] 歧视类型堆叠柱状图
  - [ ] 求职漏斗图（投递→面试→Offer）
  - [ ] 渠道有效性雷达图

---

## 🎉 总结

本次可视化映射扩展通过新增14个问题配置、3个维度、6个差异化特色，实现了：

1. ✅ **完整覆盖新增问题**：24个可视化问题全部配置
2. ✅ **支持多维度分析**：9个维度，支持单维度与交叉切片
3. ✅ **明确差异化特色**：标记问卷2独有的8大分析能力
4. ✅ **配色与图标优化**：性别图标、渐变配色、语义化颜色
5. ✅ **为后续开发铺路**：清晰的数据结构与映射关系

**核心价值**：
- 从"经济压力+就业信心"扩展到"性别+婚育+地域+歧视+行为+需求"的全景分析
- 支持"个体差异→整体画像→社会观点"的三层数据洞察
- 为"大表→派生表→可视化"的数据链路提供前端配置基础

---

**文档版本**: v1.0  
**创建时间**: 2025-01-05  
**作者**: Augment Agent

