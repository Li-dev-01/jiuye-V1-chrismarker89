# 问卷2优化 - PR3：端到端验收清单

## 📋 验收概览

**验收时间**: 待执行  
**依赖**: PR1（问卷定义）+ PR2（可视化映射）  
**验收范围**: 前端填报 → 数据提交 → 后端存储 → 数据分析 → 可视化展示  

---

## 🎯 验收目标

1. **功能完整性**：所有新增问题可正常填写与提交
2. **分支逻辑正确性**：条件显示按预期触发
3. **数据完整性**：所有字段正确入库
4. **可视化准确性**：图表数据与原始数据一致
5. **用户体验**：完成时长、流畅度、错误提示
6. **隐私合规**：敏感数据处理、匿名性保障

---

## ✅ 验收清单

### 第一阶段：前端填报测试

#### 1.1 基础信息填写

- [ ] **性别问题**
  - [ ] 4个选项正常显示（男/女/其他/不愿透露）
  - [ ] 选择后可正常保存
  - [ ] 选择"女性"后触发生育计划问题显示
  - [ ] 选择"女性"后触发婚育歧视板块显示

- [ ] **年龄问题**
  - [ ] 6个选项正常显示
  - [ ] 选择"35岁以上"后触发年龄歧视板块显示

- [ ] **婚姻状况问题**
  - [ ] 5个选项正常显示
  - [ ] 选择后影响婚育歧视板块显示

- [ ] **子女状况问题**
  - [ ] 3个选项正常显示
  - [ ] 选择后影响婚育歧视板块显示

- [ ] **生育计划问题**（条件显示）
  - [ ] 仅在性别=女性时显示
  - [ ] 5个选项正常显示
  - [ ] 可选填（required: false）

- [ ] **城市层级问题**
  - [ ] 7个选项正常显示（一线→农村/海外）

- [ ] **户籍类型问题**
  - [ ] 4个选项正常显示

- [ ] **工作年限问题**
  - [ ] 6个选项正常显示

#### 1.2 当前状态选择

- [ ] **当前状态问题**
  - [ ] 5个选项正常显示
  - [ ] 选择"全职工作"后触发收入板块
  - [ ] 选择"待业/求职中"后触发求职细节板块
  - [ ] 选择"在校学生"后触发学生职业规划板块

#### 1.3 求职歧视板块

- [ ] **歧视类型问题**（复选）
  - [ ] 14个选项正常显示
  - [ ] 可多选
  - [ ] 选择"无"后，后续问题不显示

- [ ] **歧视严重度问题**（条件显示）
  - [ ] 仅在歧视类型≠"无"时显示
  - [ ] 5个选项正常显示

- [ ] **歧视渠道问题**（条件显示）
  - [ ] 仅在歧视类型≠"无"时显示
  - [ ] 9个选项正常显示
  - [ ] 可多选

- [ ] **歧视案例开放题**（条件显示）
  - [ ] 仅在歧视类型≠"无"时显示
  - [ ] 文本框正常显示
  - [ ] 字数限制500字生效
  - [ ] 可选填

#### 1.4 个人优势与忧虑板块

- [ ] **个人优势开放题**
  - [ ] 文本框正常显示
  - [ ] 字数限制300字生效
  - [ ] 可选填

- [ ] **就业忧虑开放题**
  - [ ] 文本框正常显示
  - [ ] 字数限制300字生效
  - [ ] 可选填

- [ ] **支持类型问题**（复选）
  - [ ] 10个选项正常显示
  - [ ] 可多选
  - [ ] 必填

- [ ] **支持建议开放题**
  - [ ] 文本框正常显示
  - [ ] 字数限制300字生效
  - [ ] 可选填

#### 1.5 分支板块测试

- [ ] **年龄歧视细化板块**（条件：35+）
  - [ ] 仅在年龄=35+时显示
  - [ ] 3个问题正常显示
  - [ ] 歧视频率、转型意愿、年龄优势问题可填写

- [ ] **婚育歧视细化板块**（条件：女性）
  - [ ] 仅在性别=女性时显示
  - [ ] 3个问题正常显示
  - [ ] 询问频率、影响感知、用工要求问题可填写

- [ ] **求职细节板块**（条件：待业）
  - [ ] 仅在状态=待业时显示
  - [ ] 5个问题正常显示
  - [ ] 求职时长、投递量、转化率、渠道、Offer数量问题可填写

- [ ] **学生职业规划板块**（条件：学生）
  - [ ] 仅在状态=学生时显示
  - [ ] 4个问题正常显示
  - [ ] 实习经验、实习难度、深造意愿、准备情况问题可填写

---

### 第二阶段：数据提交与存储

#### 2.1 前端数据组装

- [ ] **sectionResponses 结构正确**
  - [ ] 所有板块按顺序组装
  - [ ] 条件板块仅在触发时包含
  - [ ] questionResponses 包含所有已填写问题

- [ ] **metadata 完整**
  - [ ] startTime、endTime、totalTimeSpent 正确
  - [ ] completionPath 记录分支路径
  - [ ] branchingDecisions 记录分支决策

#### 2.2 后端接收与验证

- [ ] **API 接收成功**
  - [ ] `/api/questionnaire-v2/submit` 返回 200
  - [ ] 返回 responseId

- [ ] **数据验证通过**
  - [ ] 必填字段校验
  - [ ] 数据类型校验
  - [ ] 字数限制校验

#### 2.3 数据库存储

- [ ] **原始数据入库**
  - [ ] questionnaire_v2_responses 表插入成功
  - [ ] questionnaire 字段包含完整 JSON
  - [ ] metadata 字段包含元数据

- [ ] **宽表扁平化**（如已实现）
  - [ ] 所有 questionId 转为列名
  - [ ] 复选题转为 JSON 数组或多列
  - [ ] 开放题文本完整存储
  - [ ] completion_path 与 branching_decisions 保留

---

### 第三阶段：数据分析与派生

#### 3.1 基础统计

- [ ] **性别分布统计**
  - [ ] 男/女/其他/不愿透露 比例正确

- [ ] **年龄分布统计**
  - [ ] 6个年龄段比例正确

- [ ] **婚育状况统计**
  - [ ] 婚姻状况、子女状况、生育计划比例正确

- [ ] **地域分布统计**
  - [ ] 城市层级、户籍类型比例正确

- [ ] **歧视类型统计**
  - [ ] 14种歧视类型频次正确
  - [ ] 支持多选统计

- [ ] **求职行为统计**
  - [ ] 求职时长、投递量、转化率、渠道、Offer 分布正确

#### 3.2 交叉分析（示例）

- [ ] **性别 × 失业率**
  - [ ] 男性/女性失业比例计算正确

- [ ] **性别 × 歧视类型**
  - [ ] 女性婚育歧视占比计算正确

- [ ] **年龄 × 歧视频率**
  - [ ] 35+年龄歧视频率计算正确

- [ ] **地域 × 薪资**
  - [ ] 一线/二线薪资差异计算正确

#### 3.3 派生表生成（如已实现）

- [ ] **性别维度表**
  - [ ] 按性别聚合失业率、经济压力、求职周期

- [ ] **歧视分析表**
  - [ ] 按歧视类型聚合严重度、渠道分布

- [ ] **渠道有效性表**
  - [ ] 按渠道聚合投递量、转化率、Offer数量

---

### 第四阶段：可视化展示

#### 4.1 基础维度图表

- [ ] **性别分布饼图**
  - [ ] 数据正确
  - [ ] 颜色与图标显示正确（👨👩🧑🔒）

- [ ] **年龄分布柱状图**
  - [ ] 数据正确
  - [ ] 6个柱子显示正确

- [ ] **婚姻状况饼图**
  - [ ] 数据正确
  - [ ] 5个分类显示正确

- [ ] **城市层级柱状图**
  - [ ] 数据正确
  - [ ] 7个柱子显示正确

- [ ] **工作年限柱状图**
  - [ ] 数据正确
  - [ ] 渐变配色正确

#### 4.2 歧视分析图表

- [ ] **歧视类型柱状图**
  - [ ] 14种类型数据正确
  - [ ] 支持多选统计（总数可能>100%）
  - [ ] 配色语义化（性别/婚育用红粉色）

- [ ] **歧视严重度柱状图**
  - [ ] 5级严重度数据正确
  - [ ] 绿→红渐变配色

- [ ] **歧视渠道柱状图**
  - [ ] 9个渠道数据正确
  - [ ] 支持多选统计

#### 4.3 求职行为图表

- [ ] **求职时长柱状图**
  - [ ] 5个时长段数据正确
  - [ ] 绿→红渐变配色

- [ ] **投递量柱状图**
  - [ ] 5个投递量段数据正确

- [ ] **转化率柱状图**
  - [ ] 5个转化率段数据正确

- [ ] **渠道使用柱状图**
  - [ ] 11个渠道数据正确
  - [ ] 支持多选统计

- [ ] **Offer数量柱状图**
  - [ ] 5个数量段数据正确
  - [ ] 红→蓝渐变配色

#### 4.4 支持需求图表

- [ ] **支持类型柱状图**
  - [ ] 10种支持类型数据正确
  - [ ] 支持多选统计
  - [ ] 按需求频次排序

---

### 第五阶段：用户体验验收

#### 5.1 完成时长

- [ ] **核心路径**（无分支）
  - [ ] 完成时长 ≤ 10分钟

- [ ] **完整路径**（含分支）
  - [ ] 完成时长 ≤ 12分钟

#### 5.2 流畅度

- [ ] **对话式交互**
  - [ ] 问题切换动画流畅
  - [ ] 无卡顿

- [ ] **分支触发**
  - [ ] 条件板块显示/隐藏无延迟
  - [ ] 进度条实时更新

#### 5.3 错误提示

- [ ] **必填校验**
  - [ ] 未填写必填题时提示清晰
  - [ ] 定位到错误题目

- [ ] **字数限制**
  - [ ] 超出字数时实时提示
  - [ ] 显示剩余字数

#### 5.4 移动端适配

- [ ] **H5 对话式界面**
  - [ ] 问题卡片正常显示
  - [ ] 选项按钮大小适中
  - [ ] 文本框输入流畅

---

### 第六阶段：隐私与合规

#### 6.1 数据用途说明

- [ ] **问卷开始前**
  - [ ] 显示数据用途与匿名声明
  - [ ] 用户可查看隐私政策

#### 6.2 敏感数据处理

- [ ] **"不愿透露"选项**
  - [ ] 性别、婚姻、子女、户籍等敏感问题均提供
  - [ ] 选择后可正常提交

- [ ] **开放题匿名**
  - [ ] 开放题文本不关联个人身份
  - [ ] 仅用于匿名聚合分析

#### 6.3 数据安全

- [ ] **传输加密**
  - [ ] HTTPS 传输

- [ ] **存储安全**
  - [ ] 敏感字段加密存储（如需）
  - [ ] 访问权限控制

---

## 🧪 测试用例

### 用例1：女性35+已婚有子女（完整分支）

**路径**：
1. 性别=女性 → 触发生育计划问题 + 婚育歧视板块
2. 年龄=35+ → 触发年龄歧视板块
3. 婚姻=已婚，子女=是
4. 状态=待业 → 触发求职细节板块
5. 歧视类型=性别+婚育+年龄 → 触发严重度+渠道问题

**预期**：
- 显示所有分支板块
- 完成时长约12分钟
- 数据完整入库

---

### 用例2：男性25岁学生（部分分支）

**路径**：
1. 性别=男性 → 不触发生育计划问题
2. 年龄=23-25岁 → 不触发年龄歧视板块
3. 状态=学生 → 触发学生职业规划板块
4. 歧视类型=无 → 不触发严重度+渠道问题

**预期**：
- 仅显示学生职业规划板块
- 完成时长约8分钟
- 数据完整入库

---

### 用例3：不愿透露敏感信息（隐私保护）

**路径**：
1. 性别=不愿透露
2. 婚姻=不愿透露
3. 子女=不愿透露
4. 歧视类型=无

**预期**：
- 可正常提交
- 不影响其他问题填写
- 统计时单独分类

---

## 📝 验收报告模板

### 验收结果

- [ ] **通过**：所有测试用例通过，无阻塞性问题
- [ ] **有条件通过**：存在非阻塞性问题，可后续优化
- [ ] **不通过**：存在阻塞性问题，需修复后重新验收

### 问题清单

| 问题ID | 严重程度 | 问题描述 | 复现步骤 | 状态 |
|--------|---------|---------|---------|------|
| - | - | - | - | - |

### 性能指标

| 指标 | 目标值 | 实际值 | 是否达标 |
|------|--------|--------|----------|
| 核心路径完成时长 | ≤10分钟 | - | - |
| 完整路径完成时长 | ≤12分钟 | - | - |
| 问题切换延迟 | <300ms | - | - |
| 数据提交成功率 | >95% | - | - |

### 数据质量

| 指标 | 目标值 | 实际值 | 是否达标 |
|------|--------|--------|----------|
| 字段完整率 | 100% | - | - |
| 分支逻辑准确率 | 100% | - | - |
| 可视化数据一致性 | 100% | - | - |

---

## 🎉 验收完成标准

1. ✅ 所有测试用例通过
2. ✅ 性能指标达标
3. ✅ 数据质量达标
4. ✅ 无阻塞性问题
5. ✅ 隐私合规检查通过

---

**文档版本**: v1.0  
**创建时间**: 2025-01-05  
**作者**: Augment Agent

