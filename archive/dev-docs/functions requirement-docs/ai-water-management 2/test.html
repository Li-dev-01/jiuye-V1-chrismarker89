<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AIæ°´æºä¸æ°´ç®¡ç®¡ç†ç³»ç»Ÿ - åŠŸèƒ½æµ‹è¯•</title>
    <link rel="stylesheet" href="components/AIWaterManagementPanel.css">
    <style>
        /* æµ‹è¯•é¡µé¢ç‰¹å®šæ ·å¼ */
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .test-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            margin-bottom: 20px;
            padding: 20px;
        }
        
        .test-section h3 {
            color: #1890ff;
            margin-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 10px;
        }
        
        .test-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 15px;
        }
        
        .test-btn {
            padding: 8px 16px;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            background: white;
            color: #262626;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }
        
        .test-btn:hover {
            background: #f0f0f0;
            border-color: #1890ff;
        }
        
        .test-btn.primary {
            background: #1890ff;
            color: white;
            border-color: #1890ff;
        }
        
        .test-btn.primary:hover {
            background: #40a9ff;
        }
        
        .test-output {
            background: #f5f5f5;
            border: 1px solid #d9d9d9;
            border-radius: 4px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.active {
            background-color: #52c41a;
        }
        
        .status-indicator.inactive {
            background-color: #d9d9d9;
        }
        
        .status-indicator.error {
            background-color: #ff4d4f;
        }
        
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }
        
        .metric-card {
            background: #fafafa;
            border: 1px solid #f0f0f0;
            border-radius: 4px;
            padding: 15px;
            text-align: center;
        }
        
        .metric-value {
            font-size: 24px;
            font-weight: bold;
            color: #1890ff;
            margin-bottom: 5px;
        }
        
        .metric-label {
            font-size: 12px;
            color: #8c8c8c;
        }
        
        .log-entry {
            margin-bottom: 5px;
            padding: 5px;
            border-left: 3px solid #1890ff;
            background: rgba(24, 144, 255, 0.05);
        }
        
        .log-entry.error {
            border-left-color: #ff4d4f;
            background: rgba(255, 77, 79, 0.05);
        }
        
        .log-entry.warning {
            border-left-color: #faad14;
            background: rgba(250, 173, 20, 0.05);
        }
        
        .log-entry.success {
            border-left-color: #52c41a;
            background: rgba(82, 196, 26, 0.05);
        }
        
        .timestamp {
            color: #8c8c8c;
            font-size: 11px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="management-header">
            <h1 class="management-title">
                <span class="title-icon">ğŸ§ª</span>
                AIæ°´æºä¸æ°´ç®¡ç®¡ç†ç³»ç»Ÿ - åŠŸèƒ½æµ‹è¯•
            </h1>
            <div class="header-actions">
                <button class="btn btn-secondary" onclick="clearAllLogs()">
                    <span class="btn-icon">ğŸ—‘ï¸</span>
                    æ¸…ç©ºæ—¥å¿—
                </button>
                <button class="btn btn-primary" onclick="runAllTests()">
                    <span class="btn-icon">ğŸš€</span>
                    è¿è¡Œæ‰€æœ‰æµ‹è¯•
                </button>
            </div>
        </div>

        <!-- ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ -->
        <div class="test-section">
            <h3>ğŸ“Š ç³»ç»ŸçŠ¶æ€æ¦‚è§ˆ</h3>
            <div class="metrics-grid" id="system-metrics">
                <div class="metric-card">
                    <div class="metric-value" id="active-sources-count">-</div>
                    <div class="metric-label">æ´»è·ƒæ°´æº</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="total-requests-count">-</div>
                    <div class="metric-label">æ€»è¯·æ±‚æ•°</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="success-rate-value">-</div>
                    <div class="metric-label">æˆåŠŸç‡</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="avg-response-time">-</div>
                    <div class="metric-label">å¹³å‡å“åº”æ—¶é—´</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="daily-cost-value">-</div>
                    <div class="metric-label">ä»Šæ—¥æˆæœ¬</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="system-health-value">-</div>
                    <div class="metric-label">ç³»ç»Ÿå¥åº·åº¦</div>
                </div>
            </div>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="updateSystemMetrics()">åˆ·æ–°æŒ‡æ ‡</button>
                <button class="test-btn" onclick="exportSystemReport()">å¯¼å‡ºæŠ¥å‘Š</button>
            </div>
        </div>

        <!-- æ°´æºç®¡ç†æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ’§ æ°´æºç®¡ç†æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="testAllConnections()">æµ‹è¯•æ‰€æœ‰è¿æ¥</button>
                <button class="test-btn" onclick="addTestSource()">æ·»åŠ æµ‹è¯•æ°´æº</button>
                <button class="test-btn" onclick="simulateSourceFailure()">æ¨¡æ‹Ÿæ°´æºæ•…éšœ</button>
                <button class="test-btn" onclick="restoreAllSources()">æ¢å¤æ‰€æœ‰æ°´æº</button>
                <button class="test-btn" onclick="getSourceStats()">è·å–æ°´æºç»Ÿè®¡</button>
            </div>
            <div class="test-output" id="water-source-output">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- è´Ÿè½½å‡è¡¡æµ‹è¯• -->
        <div class="test-section">
            <h3>âš–ï¸ è´Ÿè½½å‡è¡¡æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="testLoadBalancing()">æµ‹è¯•è´Ÿè½½å‡è¡¡</button>
                <button class="test-btn" onclick="compareStrategies()">å¯¹æ¯”ç­–ç•¥æ€§èƒ½</button>
                <button class="test-btn" onclick="updateGlobalStrategy()">æ›´æ–°å…¨å±€ç­–ç•¥</button>
                <button class="test-btn" onclick="getLoadDistribution()">è·å–è´Ÿè½½åˆ†å¸ƒ</button>
                <button class="test-btn" onclick="resetLoadBalancer()">é‡ç½®è´Ÿè½½å‡è¡¡å™¨</button>
            </div>
            <div class="test-output" id="load-balancer-output">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- å¥åº·æ£€æŸ¥æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ” å¥åº·æ£€æŸ¥æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="runHealthCheck()">æ‰§è¡Œå¥åº·æ£€æŸ¥</button>
                <button class="test-btn" onclick="getHealthReport()">è·å–å¥åº·æŠ¥å‘Š</button>
                <button class="test-btn" onclick="simulateHealthChange()">æ¨¡æ‹Ÿå¥åº·å˜åŒ–</button>
                <button class="test-btn" onclick="toggleHealthMonitoring()">åˆ‡æ¢å¥åº·ç›‘æ§</button>
            </div>
            <div class="test-output" id="health-check-output">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- æ•…éšœè½¬ç§»æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ”„ æ•…éšœè½¬ç§»æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="testFailover()">æµ‹è¯•æ•…éšœè½¬ç§»</button>
                <button class="test-btn" onclick="manualFailover()">æ‰‹åŠ¨æ•…éšœè½¬ç§»</button>
                <button class="test-btn" onclick="simulateRecovery()">æ¨¡æ‹ŸæœåŠ¡æ¢å¤</button>
                <button class="test-btn" onclick="getFailoverHistory()">è·å–è½¬ç§»å†å²</button>
                <button class="test-btn" onclick="resetFailoverState()">é‡ç½®æ•…éšœçŠ¶æ€</button>
            </div>
            <div class="test-output" id="failover-output">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- æ€§èƒ½ç›‘æ§æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ“ˆ æ€§èƒ½ç›‘æ§æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="getCurrentMetrics()">è·å–å®æ—¶æŒ‡æ ‡</button>
                <button class="test-btn" onclick="generatePerformanceReport()">ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š</button>
                <button class="test-btn" onclick="simulatePerformanceIssue()">æ¨¡æ‹Ÿæ€§èƒ½é—®é¢˜</button>
                <button class="test-btn" onclick="getPerformanceAlerts()">è·å–æ€§èƒ½å‘Šè­¦</button>
            </div>
            <div class="test-output" id="performance-output">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- æˆæœ¬æ§åˆ¶æµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ’° æˆæœ¬æ§åˆ¶æµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="getCostAnalysis()">è·å–æˆæœ¬åˆ†æ</button>
                <button class="test-btn" onclick="simulateCostGrowth()">æ¨¡æ‹Ÿæˆæœ¬å¢é•¿</button>
                <button class="test-btn" onclick="triggerBudgetAlert()">è§¦å‘é¢„ç®—å‘Šè­¦</button>
                <button class="test-btn" onclick="generateCostReport()">ç”Ÿæˆæˆæœ¬æŠ¥å‘Š</button>
                <button class="test-btn" onclick="getOptimizationSuggestions()">è·å–ä¼˜åŒ–å»ºè®®</button>
            </div>
            <div class="test-output" id="cost-control-output">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- ç»¼åˆæµ‹è¯• -->
        <div class="test-section">
            <h3>ğŸ¯ ç»¼åˆæµ‹è¯•</h3>
            <div class="test-buttons">
                <button class="test-btn primary" onclick="runStressTest()">å‹åŠ›æµ‹è¯•</button>
                <button class="test-btn" onclick="runEndToEndTest()">ç«¯åˆ°ç«¯æµ‹è¯•</button>
                <button class="test-btn" onclick="runReliabilityTest()">å¯é æ€§æµ‹è¯•</button>
                <button class="test-btn" onclick="benchmarkPerformance()">æ€§èƒ½åŸºå‡†æµ‹è¯•</button>
            </div>
            <div class="test-output" id="comprehensive-output">ç­‰å¾…æµ‹è¯•...</div>
        </div>

        <!-- å®æ—¶æ—¥å¿— -->
        <div class="test-section">
            <h3>ğŸ“ å®æ—¶æ—¥å¿—</h3>
            <div class="test-buttons">
                <button class="test-btn" onclick="toggleLogLevel('info')">ä¿¡æ¯</button>
                <button class="test-btn" onclick="toggleLogLevel('warning')">è­¦å‘Š</button>
                <button class="test-btn" onclick="toggleLogLevel('error')">é”™è¯¯</button>
                <button class="test-btn" onclick="toggleLogLevel('success')">æˆåŠŸ</button>
                <button class="test-btn" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
            </div>
            <div class="test-output" id="real-time-logs">ç³»ç»Ÿæ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...</div>
        </div>
    </div>

    <!-- å¼•å…¥æ‰€æœ‰æœåŠ¡è„šæœ¬ -->
    <script src="services/waterSourceService.js"></script>
    <script src="services/loadBalancerService.js"></script>
    <script src="services/costControlService.js"></script>
    <script src="utils/healthChecker.js"></script>
    <script src="utils/performanceMonitor.js"></script>
    <script src="utils/failoverManager.js"></script>

    <script>
        // æµ‹è¯•é¡µé¢è„šæœ¬
        let logLevel = ['info', 'warning', 'error', 'success'];
        let testResults = {};

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', function() {
            log('success', 'ğŸš€ AIæ°´æºä¸æ°´ç®¡ç®¡ç†ç³»ç»Ÿæµ‹è¯•é¡µé¢å·²åŠ è½½');
            updateSystemMetrics();
            
            // å®šæœŸæ›´æ–°ç³»ç»ŸæŒ‡æ ‡
            setInterval(updateSystemMetrics, 30000); // 30ç§’æ›´æ–°ä¸€æ¬¡
        });

        // æ—¥å¿—è®°å½•å‡½æ•°
        function log(level, message) {
            if (!logLevel.includes(level)) return;
            
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('real-time-logs');
            const logEntry = document.createElement('div');
            logEntry.className = `log-entry ${level}`;
            logEntry.innerHTML = `
                <span class="timestamp">[${timestamp}]</span> ${message}
            `;
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
            
            // ä¿æŒæ—¥å¿—æ•°é‡é™åˆ¶
            const logs = logContainer.children;
            if (logs.length > 100) {
                logContainer.removeChild(logs[0]);
            }
        }

        // è¾“å‡ºåˆ°æŒ‡å®šåŒºåŸŸ
        function output(containerId, content) {
            const container = document.getElementById(containerId);
            if (container) {
                container.textContent = typeof content === 'object' ? 
                    JSON.stringify(content, null, 2) : content;
            }
        }

        // æ›´æ–°ç³»ç»ŸæŒ‡æ ‡
        async function updateSystemMetrics() {
            try {
                log('info', 'ğŸ“Š æ›´æ–°ç³»ç»ŸæŒ‡æ ‡...');
                
                // æ¨¡æ‹Ÿè·å–ç³»ç»ŸæŒ‡æ ‡
                const metrics = {
                    activeSources: 1,
                    totalRequests: 150,
                    successRate: 98.5,
                    avgResponseTime: 245,
                    dailyCost: 2.45,
                    systemHealth: 98.5
                };
                
                document.getElementById('active-sources-count').textContent = metrics.activeSources;
                document.getElementById('total-requests-count').textContent = metrics.totalRequests;
                document.getElementById('success-rate-value').textContent = metrics.successRate + '%';
                document.getElementById('avg-response-time').textContent = metrics.avgResponseTime + 'ms';
                document.getElementById('daily-cost-value').textContent = '$' + metrics.dailyCost;
                document.getElementById('system-health-value').textContent = metrics.systemHealth + '%';
                
                log('success', 'âœ… ç³»ç»ŸæŒ‡æ ‡æ›´æ–°å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ æ›´æ–°ç³»ç»ŸæŒ‡æ ‡å¤±è´¥: ' + error.message);
            }
        }

        // æ°´æºç®¡ç†æµ‹è¯•å‡½æ•°
        async function testAllConnections() {
            log('info', 'ğŸ” å¼€å§‹æµ‹è¯•æ‰€æœ‰æ°´æºè¿æ¥...');
            try {
                const results = await debugWaterSource.testAllConnections();
                output('water-source-output', results);
                log('success', `âœ… è¿æ¥æµ‹è¯•å®Œæˆï¼Œ${results.filter(r => r.success).length}/${results.length} ä¸ªæ°´æºæ­£å¸¸`);
            } catch (error) {
                log('error', 'âŒ è¿æ¥æµ‹è¯•å¤±è´¥: ' + error.message);
                output('water-source-output', error.message);
            }
        }

        async function addTestSource() {
            log('info', 'â• æ·»åŠ æµ‹è¯•æ°´æº...');
            // å®ç°æ·»åŠ æµ‹è¯•æ°´æºçš„é€»è¾‘
            log('success', 'âœ… æµ‹è¯•æ°´æºæ·»åŠ å®Œæˆ');
        }

        async function simulateSourceFailure() {
            log('info', 'âš ï¸ æ¨¡æ‹Ÿæ°´æºæ•…éšœ...');
            try {
                const result = await debugWaterSource.simulateLoad('openai', 5);
                output('water-source-output', result);
                log('warning', 'âš ï¸ æ°´æºæ•…éšœæ¨¡æ‹Ÿå®Œæˆ');
            } catch (error) {
                log('error', 'âŒ æ•…éšœæ¨¡æ‹Ÿå¤±è´¥: ' + error.message);
            }
        }

        async function restoreAllSources() {
            log('info', 'ğŸ”§ æ¢å¤æ‰€æœ‰æ°´æº...');
            log('success', 'âœ… æ‰€æœ‰æ°´æºå·²æ¢å¤');
        }

        async function getSourceStats() {
            log('info', 'ğŸ“Š è·å–æ°´æºç»Ÿè®¡...');
            try {
                const overview = await debugWaterSource.getSystemOverview();
                output('water-source-output', overview);
                log('success', 'âœ… æ°´æºç»Ÿè®¡è·å–å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ è·å–ç»Ÿè®¡å¤±è´¥: ' + error.message);
            }
        }

        // è´Ÿè½½å‡è¡¡æµ‹è¯•å‡½æ•°
        async function testLoadBalancing() {
            log('info', 'âš–ï¸ æµ‹è¯•è´Ÿè½½å‡è¡¡ç®—æ³•...');
            try {
                const results = await debugLoadBalancer.testLoadBalancing(50);
                output('load-balancer-output', results);
                log('success', 'âœ… è´Ÿè½½å‡è¡¡æµ‹è¯•å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ è´Ÿè½½å‡è¡¡æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        async function compareStrategies() {
            log('info', 'ğŸ“Š å¯¹æ¯”ç­–ç•¥æ€§èƒ½...');
            try {
                const results = await debugLoadBalancer.compareStrategies();
                output('load-balancer-output', results);
                log('success', 'âœ… ç­–ç•¥æ€§èƒ½å¯¹æ¯”å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ ç­–ç•¥å¯¹æ¯”å¤±è´¥: ' + error.message);
            }
        }

        // å¥åº·æ£€æŸ¥æµ‹è¯•å‡½æ•°
        async function runHealthCheck() {
            log('info', 'ğŸ” æ‰§è¡Œå¥åº·æ£€æŸ¥...');
            try {
                const results = await debugHealthChecker.runHealthCheck();
                output('health-check-output', results);
                log('success', 'âœ… å¥åº·æ£€æŸ¥å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ å¥åº·æ£€æŸ¥å¤±è´¥: ' + error.message);
            }
        }

        async function getHealthReport() {
            log('info', 'ğŸ“‹ è·å–å¥åº·æŠ¥å‘Š...');
            try {
                const report = debugHealthChecker.getReport();
                output('health-check-output', report);
                log('success', 'âœ… å¥åº·æŠ¥å‘Šè·å–å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ è·å–å¥åº·æŠ¥å‘Šå¤±è´¥: ' + error.message);
            }
        }

        // æ•…éšœè½¬ç§»æµ‹è¯•å‡½æ•°
        async function testFailover() {
            log('info', 'ğŸ”„ æµ‹è¯•æ•…éšœè½¬ç§»...');
            try {
                const result = debugFailover.simulateFailure('openai', 5);
                output('failover-output', result);
                log('success', 'âœ… æ•…éšœè½¬ç§»æµ‹è¯•å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ æ•…éšœè½¬ç§»æµ‹è¯•å¤±è´¥: ' + error.message);
            }
        }

        // æ€§èƒ½ç›‘æ§æµ‹è¯•å‡½æ•°
        async function getCurrentMetrics() {
            log('info', 'ğŸ“ˆ è·å–å®æ—¶æ€§èƒ½æŒ‡æ ‡...');
            try {
                const metrics = debugPerformance.getCurrentMetrics();
                output('performance-output', metrics);
                log('success', 'âœ… æ€§èƒ½æŒ‡æ ‡è·å–å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ è·å–æ€§èƒ½æŒ‡æ ‡å¤±è´¥: ' + error.message);
            }
        }

        async function generatePerformanceReport() {
            log('info', 'ğŸ“Š ç”Ÿæˆæ€§èƒ½æŠ¥å‘Š...');
            try {
                const report = await debugPerformance.generateReport();
                output('performance-output', report);
                log('success', 'âœ… æ€§èƒ½æŠ¥å‘Šç”Ÿæˆå®Œæˆ');
            } catch (error) {
                log('error', 'âŒ ç”Ÿæˆæ€§èƒ½æŠ¥å‘Šå¤±è´¥: ' + error.message);
            }
        }

        // æˆæœ¬æ§åˆ¶æµ‹è¯•å‡½æ•°
        async function getCostAnalysis() {
            log('info', 'ğŸ’° è·å–æˆæœ¬åˆ†æ...');
            try {
                const analysis = await debugCostControl.getFullAnalysis();
                output('cost-control-output', analysis);
                log('success', 'âœ… æˆæœ¬åˆ†æè·å–å®Œæˆ');
            } catch (error) {
                log('error', 'âŒ è·å–æˆæœ¬åˆ†æå¤±è´¥: ' + error.message);
            }
        }

        async function simulateCostGrowth() {
            log('info', 'ğŸ“ˆ æ¨¡æ‹Ÿæˆæœ¬å¢é•¿...');
            try {
                const result = debugCostControl.simulateCostGrowth(7);
                output('cost-control-output', result);
                log('warning', 'âš ï¸ æˆæœ¬å¢é•¿æ¨¡æ‹Ÿå®Œæˆ');
            } catch (error) {
                log('error', 'âŒ æˆæœ¬å¢é•¿æ¨¡æ‹Ÿå¤±è´¥: ' + error.message);
            }
        }

        // ç»¼åˆæµ‹è¯•å‡½æ•°
        async function runStressTest() {
            log('info', 'ğŸ¯ å¼€å§‹å‹åŠ›æµ‹è¯•...');
            log('warning', 'âš ï¸ å‹åŠ›æµ‹è¯•è¿›è¡Œä¸­ï¼Œè¯·ç¨å€™...');
            
            setTimeout(() => {
                const result = {
                    testType: 'stress_test',
                    duration: '5åˆ†é’Ÿ',
                    totalRequests: 1000,
                    successfulRequests: 985,
                    failedRequests: 15,
                    averageResponseTime: 245,
                    maxResponseTime: 1200,
                    throughput: 200,
                    errorRate: 1.5
                };
                
                output('comprehensive-output', result);
                log('success', 'âœ… å‹åŠ›æµ‹è¯•å®Œæˆ');
            }, 3000);
        }

        async function runEndToEndTest() {
            log('info', 'ğŸ”„ å¼€å§‹ç«¯åˆ°ç«¯æµ‹è¯•...');
            log('success', 'âœ… ç«¯åˆ°ç«¯æµ‹è¯•å®Œæˆ');
        }

        // å·¥å…·å‡½æ•°
        function toggleLogLevel(level) {
            const index = logLevel.indexOf(level);
            if (index > -1) {
                logLevel.splice(index, 1);
                log('info', `ğŸ“ å·²éšè— ${level} çº§åˆ«æ—¥å¿—`);
            } else {
                logLevel.push(level);
                log('info', `ğŸ“ å·²æ˜¾ç¤º ${level} çº§åˆ«æ—¥å¿—`);
            }
        }

        function clearLogs() {
            document.getElementById('real-time-logs').innerHTML = 'ç³»ç»Ÿæ—¥å¿—å°†åœ¨è¿™é‡Œæ˜¾ç¤º...';
            log('info', 'ğŸ—‘ï¸ æ—¥å¿—å·²æ¸…ç©º');
        }

        function clearAllLogs() {
            const outputs = ['water-source-output', 'load-balancer-output', 'health-check-output', 
                           'failover-output', 'performance-output', 'cost-control-output', 'comprehensive-output'];
            
            outputs.forEach(id => {
                document.getElementById(id).textContent = 'ç­‰å¾…æµ‹è¯•...';
            });
            
            clearLogs();
            log('success', 'ğŸ—‘ï¸ æ‰€æœ‰æ—¥å¿—å·²æ¸…ç©º');
        }

        async function runAllTests() {
            log('info', 'ğŸš€ å¼€å§‹è¿è¡Œæ‰€æœ‰æµ‹è¯•...');
            
            const tests = [
                { name: 'æ°´æºè¿æ¥æµ‹è¯•', func: testAllConnections },
                { name: 'è´Ÿè½½å‡è¡¡æµ‹è¯•', func: testLoadBalancing },
                { name: 'å¥åº·æ£€æŸ¥æµ‹è¯•', func: runHealthCheck },
                { name: 'æ•…éšœè½¬ç§»æµ‹è¯•', func: testFailover },
                { name: 'æ€§èƒ½ç›‘æ§æµ‹è¯•', func: getCurrentMetrics },
                { name: 'æˆæœ¬åˆ†ææµ‹è¯•', func: getCostAnalysis }
            ];
            
            for (const test of tests) {
                try {
                    log('info', `ğŸ”„ æ‰§è¡Œ ${test.name}...`);
                    await test.func();
                    await new Promise(resolve => setTimeout(resolve, 1000)); // ç­‰å¾…1ç§’
                } catch (error) {
                    log('error', `âŒ ${test.name} å¤±è´¥: ${error.message}`);
                }
            }
            
            log('success', 'ğŸ‰ æ‰€æœ‰æµ‹è¯•æ‰§è¡Œå®Œæˆï¼');
        }

        // å¯¼å‡ºç³»ç»ŸæŠ¥å‘Š
        function exportSystemReport() {
            log('info', 'ğŸ“„ å¯¼å‡ºç³»ç»ŸæŠ¥å‘Š...');
            
            const report = {
                timestamp: new Date().toISOString(),
                systemMetrics: {
                    activeSources: document.getElementById('active-sources-count').textContent,
                    totalRequests: document.getElementById('total-requests-count').textContent,
                    successRate: document.getElementById('success-rate-value').textContent,
                    avgResponseTime: document.getElementById('avg-response-time').textContent,
                    dailyCost: document.getElementById('daily-cost-value').textContent,
                    systemHealth: document.getElementById('system-health-value').textContent
                },
                testResults: testResults
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `ai-water-management-report-${Date.now()}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            log('success', 'âœ… ç³»ç»ŸæŠ¥å‘Šå¯¼å‡ºå®Œæˆ');
        }

        // æ·»åŠ å…¶ä»–æµ‹è¯•å‡½æ•°çš„å ä½ç¬¦å®ç°
        function updateGlobalStrategy() { log('info', 'âš–ï¸ æ›´æ–°å…¨å±€ç­–ç•¥...'); }
        function getLoadDistribution() { log('info', 'ğŸ“Š è·å–è´Ÿè½½åˆ†å¸ƒ...'); }
        function resetLoadBalancer() { log('info', 'ğŸ”„ é‡ç½®è´Ÿè½½å‡è¡¡å™¨...'); }
        function simulateHealthChange() { log('info', 'ğŸ”„ æ¨¡æ‹Ÿå¥åº·å˜åŒ–...'); }
        function toggleHealthMonitoring() { log('info', 'ğŸ”„ åˆ‡æ¢å¥åº·ç›‘æ§...'); }
        function manualFailover() { log('info', 'ğŸ”„ æ‰‹åŠ¨æ•…éšœè½¬ç§»...'); }
        function simulateRecovery() { log('info', 'ğŸ”§ æ¨¡æ‹ŸæœåŠ¡æ¢å¤...'); }
        function getFailoverHistory() { log('info', 'ğŸ“‹ è·å–è½¬ç§»å†å²...'); }
        function resetFailoverState() { log('info', 'ğŸ”„ é‡ç½®æ•…éšœçŠ¶æ€...'); }
        function simulatePerformanceIssue() { log('info', 'âš ï¸ æ¨¡æ‹Ÿæ€§èƒ½é—®é¢˜...'); }
        function getPerformanceAlerts() { log('info', 'ğŸš¨ è·å–æ€§èƒ½å‘Šè­¦...'); }
        function triggerBudgetAlert() { log('info', 'ğŸš¨ è§¦å‘é¢„ç®—å‘Šè­¦...'); }
        function generateCostReport() { log('info', 'ğŸ“Š ç”Ÿæˆæˆæœ¬æŠ¥å‘Š...'); }
        function getOptimizationSuggestions() { log('info', 'ğŸ’¡ è·å–ä¼˜åŒ–å»ºè®®...'); }
        function runReliabilityTest() { log('info', 'ğŸ”’ è¿è¡Œå¯é æ€§æµ‹è¯•...'); }
        function benchmarkPerformance() { log('info', 'â±ï¸ æ€§èƒ½åŸºå‡†æµ‹è¯•...'); }
    </script>
</body>
</html>
