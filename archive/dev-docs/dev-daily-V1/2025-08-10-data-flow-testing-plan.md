# 大学生就业问卷调查平台V1 - 数据流转测试计划

## 📋 测试概述

**测试目标**: 验证项目核心数据流转功能的完整性、一致性和可靠性  
**测试范围**: 半匿名用户注册、问卷提交、故事墙关联、数据库一致性  
**测试环境**: 本地开发环境 + Cloudflare在线部署环境  
**测试日期**: 2025年8月10日  
**测试负责人**: 项目团队  

## 🎯 核心测试目标

### 1. 数据完整性验证
- 用户注册数据的完整存储
- 问卷数据的完整提交和存储
- 故事墙数据的正确关联

### 2. 数据一致性验证
- 用户ID在各表间的一致性
- 数据关联关系的正确性
- 跨表数据的同步性

### 3. 业务流程验证
- 半匿名用户注册流程
- 问卷提交完整流程
- 故事墙提交关联流程

## 🏗️ 项目架构分析

### 数据库表结构
```
核心表关系:
- questionnaire_users (问卷用户表)
- universal_questionnaire_responses (通用问卷响应表)
- raw_story_submissions (原始故事提交表)
- valid_stories (有效故事表)
- questionnaire_sessions (会话表)
```

### 数据流转路径
```
用户注册 → UUID生成 → 身份验证 → 会话创建
     ↓
问卷填写 → 数据验证 → 数据存储 → 用户关联
     ↓
故事提交 → 内容审核 → 数据关联 → 展示发布
```

## 📊 测试环境状态

### 当前项目状态
- **前端开发**: 95% 完成 ✅
- **后端开发**: 85% 完成 ✅
- **功能测试**: 90% 完成 ✅
- **部署准备**: 80% 完成 ✅

### 技术栈
- **前端**: React 18.3.1 + TypeScript + Vite
- **后端**: Node.js + Hono.js + Cloudflare Workers
- **数据库**: MockDatabase (开发) / Cloudflare D1 (生产)
- **认证**: JWT Token + UUID系统

## 🧪 详细测试计划

### Phase 1: 项目现状分析与环境准备

#### 1.1 环境状态检查
- [ ] 确认本地开发环境运行状态
- [ ] 检查Cloudflare部署环境状态
- [ ] 验证数据库连接和表结构
- [ ] 确认API接口可用性

#### 1.2 测试数据准备
- [ ] 准备测试用的A+B组合数据
- [ ] 准备问卷测试数据集
- [ ] 准备故事墙测试内容
- [ ] 设置测试用户账号

#### 1.3 测试工具准备
- [ ] 配置API测试工具 (Postman/curl)
- [ ] 准备数据库查询脚本
- [ ] 设置日志监控工具
- [ ] 准备性能测试工具

### Phase 2: 半匿名用户注册流程测试

#### 2.1 A+B组合验证测试
**测试场景**: 验证A+B组合的格式验证和处理
```
测试用例:
- A值: 11位数字 (如: 13812345678)
- B值: 4位或6位数字 (如: 1234, 123456)
- 无效格式测试
- 边界值测试
```

#### 2.2 身份哈希生成测试
**测试场景**: 验证身份哈希的唯一性和一致性
```
验证点:
- 相同A+B组合生成相同哈希
- 不同A+B组合生成不同哈希
- 哈希算法的安全性
- 哈希存储的正确性
```

#### 2.3 UUID生成和用户创建测试
**测试场景**: 验证UUID生成规则和用户数据创建
```
验证点:
- UUID格式: 'semi_anonymous-timestamp-random'
- 用户类型设置正确
- 权限配置正确
- 用户状态设置
- 创建时间记录
```

#### 2.4 会话管理测试
**测试场景**: 验证用户会话的创建和管理
```
验证点:
- 会话创建成功
- JWT Token生成
- 会话状态管理
- 设备信息记录
- IP地址记录
```

### Phase 3: 问卷提交数据流转测试

#### 3.1 问卷数据结构验证
**测试场景**: 验证6页问卷数据的结构和完整性
```
问卷页面:
1. 个人基本信息
2. 教育背景信息
3. 就业现状信息
4. 求职经历信息
5. 就业状态信息
6. 补充信息
```

#### 3.2 数据提交流程测试
**测试场景**: 验证问卷数据提交的完整流程
```
测试步骤:
1. 用户认证状态验证
2. 问卷数据格式验证
3. 数据提交API调用
4. 数据库存储验证
5. 响应数据验证
```

#### 3.3 用户ID关联测试
**测试场景**: 验证问卷数据与用户ID的正确关联
```
验证点:
- user_uuid字段正确填充
- 数据关联关系正确
- 外键约束正常
- 数据查询正确
```

#### 3.4 数据完整性测试
**测试场景**: 验证问卷数据的完整性和一致性
```
验证点:
- JSON数据格式正确
- 必填字段完整
- 数据类型正确
- 字符编码正确
```

### Phase 4: 故事墙关联提交测试

#### 4.1 故事数据结构测试
**测试场景**: 验证故事墙数据结构和字段
```
故事字段:
- title: 故事标题
- content: 故事内容
- category: 故事分类
- tags: 标签数组
- user_id: 用户ID关联
```

#### 4.2 数据关联测试
**测试场景**: 验证故事与用户ID的关联关系
```
验证点:
- user_id字段正确关联
- 数据UUID生成正确
- 原始表和有效表数据一致
- 审核状态设置正确
```

#### 4.3 审核流程测试
**测试场景**: 验证故事审核和状态管理
```
审核流程:
1. 原始故事提交 (raw_story_submissions)
2. 自动审核处理
3. 有效故事创建 (valid_stories)
4. 状态更新和通知
```

### Phase 5: 数据库一致性验证

#### 5.1 跨表数据一致性检查
**测试场景**: 验证相关表间数据的一致性
```sql
-- 用户数据一致性检查
SELECT COUNT(*) FROM questionnaire_users WHERE uuid NOT IN 
(SELECT DISTINCT user_uuid FROM universal_questionnaire_responses WHERE user_uuid IS NOT NULL);

-- 问卷数据完整性检查
SELECT COUNT(*) FROM universal_questionnaire_responses WHERE user_uuid IS NULL;

-- 故事关联数据检查
SELECT COUNT(*) FROM valid_stories WHERE user_id NOT IN 
(SELECT uuid FROM questionnaire_users);
```

#### 5.2 数据引用完整性测试
**测试场景**: 验证外键约束和引用完整性
```
验证点:
- 外键约束正常工作
- 级联删除设置正确
- 孤立数据检查
- 引用关系完整
```

#### 5.3 数据同步性测试
**测试场景**: 验证数据更新的同步性
```
测试步骤:
1. 更新用户信息
2. 检查关联表数据同步
3. 验证数据一致性
4. 测试并发更新场景
```

## 📈 测试执行计划

### 测试时间安排
- **Phase 1**: 环境准备 (2小时)
- **Phase 2**: 用户注册测试 (3小时)
- **Phase 3**: 问卷提交测试 (4小时)
- **Phase 4**: 故事墙测试 (3小时)
- **Phase 5**: 数据一致性测试 (2小时)
- **总计**: 14小时

### 测试资源需求
- 测试人员: 1-2人
- 测试环境: 本地 + 在线环境
- 测试工具: API测试工具、数据库工具
- 测试数据: 准备充足的测试数据集

## 🎯 成功标准

### 功能性标准
- [ ] 所有API接口正常响应
- [ ] 数据存储完整无误
- [ ] 用户ID关联正确
- [ ] 业务流程顺畅

### 性能标准
- [ ] API响应时间 < 2秒
- [ ] 数据库查询效率良好
- [ ] 并发处理能力正常
- [ ] 内存使用合理

### 数据质量标准
- [ ] 数据完整性 100%
- [ ] 数据一致性 100%
- [ ] 数据关联正确性 100%
- [ ] 无数据丢失或损坏

## 🚨 风险评估

### 高风险项
- 数据库连接稳定性
- 并发数据一致性
- UUID生成唯一性
- 跨表数据同步

### 中风险项
- API接口性能
- 前端数据验证
- 错误处理机制
- 日志记录完整性

### 低风险项
- UI界面显示
- 静态资源加载
- 缓存机制
- 文档完整性

## 📝 测试记录要求

### 测试日志
- 详细记录每个测试步骤
- 记录测试数据和结果
- 记录发现的问题和异常
- 记录性能数据

### 问题跟踪
- 问题描述和重现步骤
- 问题严重程度分级
- 修复建议和方案
- 验证结果记录

---

**文档版本**: v1.0  
**创建日期**: 2025年8月10日  
**最后更新**: 2025年8月10日  
**下次更新**: 根据测试进展更新
