# 用户画像系统测试指南

> **版本**: v1.0  
> **测试环境**: 生产环境  
> **测试日期**: 2025-10-05

---

## 🎯 测试目标

验证用户画像系统的以下功能：
1. 标签自动生成
2. 情绪识别
3. 励志名言弹窗
4. 数据统计更新

---

## 🧪 测试场景

### 场景1：负面情绪用户（应该显示励志名言）

**测试步骤**:
1. 访问问卷页面：https://2685e47b.college-employment-survey-frontend-l84.pages.dev/questionnaire-v2
2. 填写以下答案（模拟负面情绪）：
   - 年龄段：23-25岁
   - 学历：本科
   - 就业状态：求职中
   - 就业信心：非常焦虑
   - 经济压力：非常高
   - 是否有负债：是
   - 月薪：3000以下
3. 提交问卷

**预期结果**:
- ✅ 提交成功
- ✅ 弹出励志名言窗口
- ✅ 显示名言内容（如："每一次拒绝都是离成功更近一步"）
- ✅ 显示用户标签（如：应届求职者、就业焦虑、高经济压力等）
- ✅ 点击"我知道了"后跳转到故事墙

**生成的标签**（预期）:
- age-23-25（23-25岁）
- education-bachelor（本科学历）
- job-seeking（求职中）
- anxious（就业焦虑）
- high-economic-pressure（高经济压力）
- has-debt（有负债）
- young-graduate-job-seeker（应届求职者）
- stressed-young-professional（压力青年）
- debt-youth（负债青年）
- confused-graduate（迷茫毕业生）

**情绪分析**（预期）:
- 情绪类型：negative
- 负面分数：≥ 4
- 需要鼓励：true

---

### 场景2：正面情绪用户（不应显示励志名言）

**测试步骤**:
1. 访问问卷页面
2. 填写以下答案（模拟正面情绪）：
   - 年龄段：26-30岁
   - 学历：硕士
   - 就业状态：已就业
   - 就业信心：非常自信
   - 经济压力：低
   - 是否有负债：否
   - 月薪：12000-20000
3. 提交问卷

**预期结果**:
- ✅ 提交成功
- ✅ **不显示**励志名言窗口
- ✅ 直接跳转到故事墙

**生成的标签**（预期）:
- age-26-30（26-30岁）
- education-master（硕士学历）
- employed（已就业）
- confident（就业信心强）
- low-economic-pressure（低经济压力）
- high-achiever（高学历精英）

**情绪分析**（预期）:
- 情绪类型：positive
- 正面分数：> 负面分数
- 需要鼓励：false

---

### 场景3：中性情绪用户

**测试步骤**:
1. 访问问卷页面
2. 填写以下答案（模拟中性情绪）：
   - 年龄段：23-25岁
   - 学历：本科
   - 就业状态：在校学生
   - 就业信心：中性
   - 经济压力：中等
   - 是否有负债：否
   - 月薪：5000-8000
3. 提交问卷

**预期结果**:
- ✅ 提交成功
- ✅ **不显示**励志名言窗口（负面分数 < 4）
- ✅ 直接跳转到故事墙

**情绪分析**（预期）:
- 情绪类型：neutral
- 需要鼓励：false

---

## 🔍 后端数据验证

### 查询标签统计

使用 Wrangler CLI 查询：

```bash
cd backend
npx wrangler d1 execute college-employment-survey --remote --command "SELECT * FROM questionnaire_tag_statistics WHERE questionnaire_id = 'questionnaire-v2-2024' ORDER BY count DESC LIMIT 10"
```

**预期结果**:
```
tag_key                        | tag_name      | count | percentage
-------------------------------|---------------|-------|------------
young-graduate-job-seeker      | 应届求职者     | 1     | 33.3
age-23-25                      | 23-25岁       | 1     | 33.3
education-bachelor             | 本科学历       | 1     | 33.3
...
```

### 查询情绪统计

```bash
npx wrangler d1 execute college-employment-survey --remote --command "SELECT * FROM questionnaire_emotion_statistics WHERE questionnaire_id = 'questionnaire-v2-2024'"
```

**预期结果**:
```
emotion_type | count | percentage
-------------|-------|------------
negative     | 1     | 33.3
positive     | 1     | 33.3
neutral      | 1     | 33.3
```

### 查询励志名言使用情况

```bash
npx wrangler d1 execute college-employment-survey --remote --command "SELECT quote_text, category, usage_count FROM motivational_quotes WHERE usage_count > 0 ORDER BY usage_count DESC LIMIT 5"
```

**预期结果**:
```
quote_text                          | category   | usage_count
------------------------------------|------------|-------------
每一次拒绝都是离成功更近一步          | 求职励志    | 1
机会总是留给有准备的人               | 求职励志    | 1
...
```

---

## 📊 前端控制台日志

### 成功提交后的日志（负面情绪）

```
📊 开始生成用户画像标签...
✅ 生成了 10 个标签: 应届求职者, 23-25岁, 本科学历, 求职中, 就业焦虑, 高经济压力, 有负债, 压力青年, 负债青年, 迷茫毕业生
✅ 标签统计已更新
😊 情绪分析结果: negative (置信度: 0.75)
   正面分数: 0, 负面分数: 6
✅ 情绪统计已更新
💪 检测到需要鼓励，正在选择励志名言...
✨ 选择了励志名言: "每一次拒绝都是离成功更近一步"
✅ 用户画像数据生成完成
📊 收到用户画像数据: {...}
💪 显示励志名言弹窗
```

### 成功提交后的日志（正面情绪）

```
📊 开始生成用户画像标签...
✅ 生成了 6 个标签: 26-30岁, 硕士学历, 已就业, 就业信心强, 低经济压力, 高学历精英
✅ 标签统计已更新
😊 情绪分析结果: positive (置信度: 0.80)
   正面分数: 5, 负面分数: 0
✅ 情绪统计已更新
✅ 用户画像数据生成完成
```

---

## 🐛 常见问题排查

### 问题1：弹窗没有显示

**可能原因**:
1. 负面分数 < 4（不满足鼓励条件）
2. 情绪类型不是 negative
3. 前端状态未正确更新

**排查步骤**:
1. 检查浏览器控制台日志
2. 查看 API 返回的 `userProfile.emotion.needsEncouragement` 字段
3. 确认 `userProfile.motivationalQuote` 不为 null

### 问题2：标签统计未更新

**可能原因**:
1. 数据库写入失败
2. 百分比计算错误

**排查步骤**:
1. 查询数据库确认数据是否写入
2. 检查后端日志是否有错误
3. 手动执行百分比计算SQL

### 问题3：励志名言选择不合适

**可能原因**:
1. 标签匹配逻辑问题
2. 名言库数据不足

**排查步骤**:
1. 检查用户标签是否正确生成
2. 查询名言库确认是否有匹配的名言
3. 查看名言选择策略日志

---

## ✅ 测试检查清单

### 功能测试
- [ ] 负面情绪用户显示励志名言弹窗
- [ ] 正面情绪用户不显示弹窗
- [ ] 中性情绪用户不显示弹窗
- [ ] 弹窗样式正常（渐变、动画、响应式）
- [ ] 用户标签正确显示（最多5个）
- [ ] 关闭弹窗后正确跳转到故事墙

### 数据测试
- [ ] 标签统计表正确更新
- [ ] 标签百分比正确计算
- [ ] 情绪统计表正确更新
- [ ] 情绪百分比正确计算
- [ ] 励志名言使用次数正确追踪

### 性能测试
- [ ] 问卷提交响应时间 < 2秒
- [ ] 标签生成不影响提交速度
- [ ] 弹窗动画流畅

### 兼容性测试
- [ ] Chrome浏览器正常
- [ ] Safari浏览器正常
- [ ] 移动端浏览器正常
- [ ] 不同屏幕尺寸适配正常

---

## 📝 测试报告模板

```markdown
## 测试报告

**测试人员**: [姓名]
**测试日期**: [日期]
**测试环境**: 生产环境

### 测试结果

| 测试场景 | 预期结果 | 实际结果 | 状态 |
|---------|---------|---------|------|
| 负面情绪用户 | 显示励志名言 | [实际情况] | ✅/❌ |
| 正面情绪用户 | 不显示弹窗 | [实际情况] | ✅/❌ |
| 中性情绪用户 | 不显示弹窗 | [实际情况] | ✅/❌ |
| 标签统计更新 | 数据正确 | [实际情况] | ✅/❌ |
| 情绪统计更新 | 数据正确 | [实际情况] | ✅/❌ |

### 发现的问题

1. [问题描述]
   - 严重程度: [高/中/低]
   - 复现步骤: [步骤]
   - 截图: [附件]

### 建议

[测试建议]

### 总结

[测试总结]
```

---

**文档维护者**: AI Assistant  
**最后更新**: 2025-10-05

