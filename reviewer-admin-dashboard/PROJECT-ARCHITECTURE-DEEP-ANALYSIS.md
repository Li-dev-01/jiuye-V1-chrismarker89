# ğŸ” reviewer-admin-dashboard é¡¹ç›®æ¶æ„æ·±åº¦åˆ†ææŠ¥å‘Š

**åˆ†ææ—¶é—´**: 2024å¹´9æœˆ24æ—¥  
**åˆ†æç›®æ ‡**: æ·±å…¥ç†è§£é¡¹ç›®å…¨å±€æ¶æ„å’Œè®¤è¯é—®é¢˜æ ¹æº  
**å½“å‰çŠ¶æ€**: åå¤å‡ºç°500/401è®¤è¯é”™è¯¯  

## ğŸ“‹ é¡¹ç›®å…¨å±€æ¶æ„æ¦‚è§ˆ

### **ğŸ¯ é¡¹ç›®è®¾è®¡åˆè¡·**

æ ¹æ®æ–‡æ¡£åˆ†æï¼Œ`reviewer-admin-dashboard` æ˜¯ä½œä¸º**ç‹¬ç«‹ç®¡ç†å‰ç«¯**è®¾è®¡çš„ï¼š

#### **åŸå§‹é—®é¢˜**
- ä¸»é¡¹ç›® `college-employment-survey-frontend` å­˜åœ¨å¤æ‚çš„åŒè®¤è¯æ¶æ„
- ç®¡ç†å‘˜åŠŸèƒ½ä¸ç”¨æˆ·åŠŸèƒ½æ··åˆï¼Œå¯¼è‡´è®¤è¯å†²çª
- ç»´æŠ¤æˆæœ¬é«˜ï¼Œé—®é¢˜é¢‘å‘

#### **è§£å†³æ–¹æ¡ˆ**
- åˆ›å»º**å®Œå…¨ç‹¬ç«‹**çš„ç®¡ç†å‰ç«¯
- **é›¶é£é™©**å¹¶è¡Œå¼€å‘ï¼Œä¸å½±å“ä¸»ç³»ç»Ÿ
- ä½¿ç”¨**ç›¸åŒçš„åç«¯API**ï¼Œä½†ç®€åŒ–å‰ç«¯è®¤è¯é€»è¾‘

### **ğŸ—ï¸ å½“å‰é¡¹ç›®æ¶æ„**

```
reviewer-admin-dashboard (ç‹¬ç«‹å‰ç«¯)
â”œâ”€â”€ ğŸ¯ è®¾è®¡ç›®æ ‡: ç®€åŒ–çš„ç®¡ç†ç•Œé¢
â”œâ”€â”€ ğŸ”§ æŠ€æœ¯æ ˆ: React + TypeScript + Ant Design + Zustand
â”œâ”€â”€ ğŸŒ éƒ¨ç½²: Cloudflare Pages (reviewer-admin-dashboard.pages.dev)
â”œâ”€â”€ ğŸ”— åç«¯: å¤ç”¨ç°æœ‰API (employment-survey-api-prod.chrismarker89.workers.dev)
â””â”€â”€ ğŸ‘¥ ç”¨æˆ·è§’è‰²: å®¡æ ¸å‘˜ + ç®¡ç†å‘˜ + è¶…çº§ç®¡ç†å‘˜
```

## ğŸš¨ **å…³é”®å‘ç°: è®¤è¯æ¶æ„å¹¶éç®€åŒ–**

### **âŒ é¢„æœŸçš„ç®€åŒ–è®¾è®¡ vs âœ… å®é™…çš„å¤æ‚å®ç°**

#### **é¢„æœŸè®¾è®¡** (æ–‡æ¡£ä¸­çš„ç†æƒ³çŠ¶æ€):
```typescript
// ç®€å•ç»Ÿä¸€çš„è®¤è¯
POST /api/auth/login
{
  username: string,
  password: string,
  userType: 'reviewer' | 'admin' | 'super_admin'
}

// ç»Ÿä¸€Tokenæ ¼å¼
auth_token_${userType}_${timestamp}
```

#### **å®é™…å®ç°** (å½“å‰ä»£ç ):
```typescript
// å¤æ‚çš„UUIDè®¤è¯ç³»ç»Ÿ
POST /api/uuid/auth/admin
{
  username: credentials.username,
  password: credentials.password,
  userType: userType,
  deviceInfo: { userAgent, timestamp }
}

// å¤æ‚çš„TokenéªŒè¯
POST /api/uuid/auth/validate
{ sessionToken: token }
```

## ğŸ” **è®¤è¯ç³»ç»Ÿæ·±åº¦åˆ†æ**

### **1. å‰ç«¯è®¤è¯å®ç°**

#### **ç™»å½•æµç¨‹** (`src/stores/authStore.ts`):
```typescript
// ä½¿ç”¨UUIDç®¡ç†å‘˜è®¤è¯APIï¼Œæ”¯æŒå¤šç§ç”¨æˆ·è§’è‰²
const response = await apiClient.post<any>('/api/uuid/auth/admin', {
  username: credentials.username,
  password: credentials.password,
  userType: userType, // åŠ¨æ€æŒ‡å®šç”¨æˆ·ç±»å‹
  deviceInfo: {
    userAgent: navigator.userAgent,
    timestamp: Date.now()
  }
});

const { user, session } = response.data.data;
const token = session.sessionId; // ä½¿ç”¨session IDä½œä¸ºtoken
```

#### **TokenéªŒè¯æµç¨‹**:
```typescript
const response = await apiClient.post('/api/uuid/auth/validate', {
  sessionToken: token
});
```

#### **APIè¯·æ±‚æ‹¦æˆªå™¨**:
```typescript
// åŒé‡Tokenå‘é€
config.headers.Authorization = `Bearer ${token}`;
config.headers['X-Session-ID'] = token;
```

### **2. åç«¯è®¤è¯æœŸæœ›**

æ ¹æ®é”™è¯¯åˆ†æï¼Œåç«¯æœŸæœ›ï¼š
- æŸ¥è¯¢ `user_sessions` è¡¨
- JOIN `universal_users` è¡¨
- éªŒè¯Tokenæœ‰æ•ˆæ€§å’Œè¿‡æœŸæ—¶é—´
- è¿”å›å®Œæ•´ç”¨æˆ·ä¿¡æ¯

### **3. è®¤è¯å¤æ‚æ€§æ ¹æº**

#### **å¤šå±‚æƒé™éªŒè¯**:
```typescript
// åç«¯ä¸­é—´ä»¶å±‚çº§
reviewer.use('*', unifiedAuthMiddleware);
reviewer.use('*', requireUnifiedDomain(UserDomain.MANAGEMENT));
reviewer.use('*', requireUnifiedRole(UnifiedUserType.REVIEWER, UnifiedUserType.ADMIN, UnifiedUserType.SUPER_ADMIN));
```

#### **æ•°æ®åº“ä¾èµ–**:
- ä¾èµ–å¤æ‚çš„æ•°æ®åº“è¡¨ç»“æ„
- éœ€è¦JOINæŸ¥è¯¢å¤šä¸ªè¡¨
- ä¼šè¯ç®¡ç†å¤æ‚

## ğŸ¯ **é—®é¢˜æ ¹æºåˆ†æ**

### **âŒ è®¾è®¡ä¸å®ç°ä¸ä¸€è‡´**

1. **æ–‡æ¡£è®¾è®¡**: ç®€åŒ–çš„ç‹¬ç«‹å‰ç«¯
2. **å®é™…å®ç°**: å¤ç”¨äº†å¤æ‚çš„UUIDè®¤è¯ç³»ç»Ÿ
3. **ç»“æœ**: ç»§æ‰¿äº†åŸç³»ç»Ÿçš„æ‰€æœ‰å¤æ‚æ€§å’Œé—®é¢˜

### **âŒ è®¤è¯æ¶æ„è¿‡åº¦å¤æ‚**

#### **å½“å‰è®¤è¯æµç¨‹**:
```
1. å‰ç«¯å‘é€å¤æ‚ç™»å½•è¯·æ±‚ (åŒ…å«deviceInfo)
2. åç«¯ç”Ÿæˆsessionå¹¶å­˜å‚¨åˆ°æ•°æ®åº“
3. å‰ç«¯è·å–sessionIdä½œä¸ºtoken
4. æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦éªŒè¯sessionæœ‰æ•ˆæ€§
5. åç«¯æŸ¥è¯¢æ•°æ®åº“éªŒè¯token
6. å¤šå±‚æƒé™ä¸­é—´ä»¶éªŒè¯
```

#### **ç†æƒ³çš„ç®€åŒ–æµç¨‹**:
```
1. å‰ç«¯å‘é€ç®€å•ç™»å½•è¯·æ±‚
2. åç«¯éªŒè¯ç”¨æˆ·åå¯†ç 
3. è¿”å›ç®€å•çš„JWT token
4. å‰ç«¯ä½¿ç”¨tokenè®¿é—®API
5. åç«¯éªŒè¯JWTç­¾å
```

### **âŒ æ•°æ®åº“è¡¨ç»“æ„é—®é¢˜**

å½“å‰ä¾èµ–çš„è¡¨å¯èƒ½å­˜åœ¨é—®é¢˜ï¼š
- `user_sessions` è¡¨å¯èƒ½ä¸å­˜åœ¨æˆ–æ•°æ®ä¸å®Œæ•´
- `universal_users` è¡¨å¯èƒ½ç¼ºå°‘å¿…è¦å­—æ®µ
- JOINæŸ¥è¯¢å¯èƒ½å¤±è´¥

## ğŸ“Š **é¡¹ç›®æ¶æ„è¯„ä¼°**

### **ğŸ”´ å½“å‰æ¶æ„é—®é¢˜**

| æ–¹é¢ | é—®é¢˜ | å½±å“ |
|------|------|------|
| **è®¾è®¡ä¸€è‡´æ€§** | æ–‡æ¡£ä¸å®ç°ä¸ç¬¦ | å¼€å‘å›°æƒ‘ï¼Œç»´æŠ¤å›°éš¾ |
| **è®¤è¯å¤æ‚åº¦** | è¿‡åº¦å¤æ‚çš„UUIDç³»ç»Ÿ | é¢‘ç¹è®¤è¯é”™è¯¯ |
| **æ•°æ®åº“ä¾èµ–** | å¤æ‚çš„è¡¨ç»“æ„ä¾èµ– | å•ç‚¹æ•…éšœé£é™© |
| **é”™è¯¯å¤„ç†** | ç¼ºä¹è¯¦ç»†é”™è¯¯ä¿¡æ¯ | è°ƒè¯•å›°éš¾ |
| **ä»£ç å¤ç”¨** | ç›´æ¥å¤ç”¨å¤æ‚ç³»ç»Ÿ | ç»§æ‰¿æ‰€æœ‰é—®é¢˜ |

### **ğŸŸ¢ ç†æƒ³æ¶æ„ç‰¹å¾**

| æ–¹é¢ | ç†æƒ³çŠ¶æ€ | ä¼˜åŠ¿ |
|------|---------|------|
| **è®¾è®¡ä¸€è‡´æ€§** | æ–‡æ¡£ä¸å®ç°å®Œå…¨ä¸€è‡´ | æ¸…æ™°çš„å¼€å‘æŒ‡å¯¼ |
| **è®¤è¯ç®€åŒ–** | JWTæˆ–ç®€å•TokenéªŒè¯ | å‡å°‘æ•…éšœç‚¹ |
| **æ•°æ®åº“ç‹¬ç«‹** | æœ€å°åŒ–æ•°æ®åº“ä¾èµ– | æé«˜å¯é æ€§ |
| **é”™è¯¯å¤„ç†** | è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿— | å¿«é€Ÿé—®é¢˜å®šä½ |
| **ä»£ç ç‹¬ç«‹** | ç‹¬ç«‹çš„è®¤è¯å®ç° | é¿å…ç»§æ‰¿é—®é¢˜ |

## ğŸ’¡ **æ ¹æœ¬é—®é¢˜è¯Šæ–­**

### **ğŸ¯ æ ¸å¿ƒé—®é¢˜**

**reviewer-admin-dashboard è™½ç„¶æ˜¯ç‹¬ç«‹é¡¹ç›®ï¼Œä½†è®¤è¯ç³»ç»Ÿå¹¶æœªç®€åŒ–ï¼Œè€Œæ˜¯ç›´æ¥å¤ç”¨äº†å¤æ‚çš„UUIDè®¤è¯æ¶æ„ï¼Œå¯¼è‡´ï¼š**

1. **ç»§æ‰¿äº†åŸç³»ç»Ÿçš„æ‰€æœ‰å¤æ‚æ€§**
2. **ä¾èµ–äº†å¯èƒ½æœ‰é—®é¢˜çš„æ•°æ®åº“è¡¨ç»“æ„**
3. **æ²¡æœ‰å®ç°æ–‡æ¡£ä¸­æè¿°çš„ç®€åŒ–è®¾è®¡**
4. **åå¤å‡ºç°è®¤è¯é”™è¯¯ï¼Œæ— æ³•ç¨³å®šå·¥ä½œ**

### **ğŸ” å…·ä½“æŠ€æœ¯é—®é¢˜**

1. **æ•°æ®åº“æŸ¥è¯¢å¤±è´¥**: `user_sessions` å’Œ `universal_users` è¡¨å¯èƒ½æœ‰é—®é¢˜
2. **Tokenæ ¼å¼å¤æ‚**: sessionIdæ ¼å¼å¯èƒ½ä¸è¢«åç«¯æ­£ç¡®è¯†åˆ«
3. **æƒé™éªŒè¯å†²çª**: å¤šå±‚ä¸­é—´ä»¶å¯èƒ½äº§ç”Ÿå†²çª
4. **é”™è¯¯å¤„ç†ä¸è¶³**: 500é”™è¯¯ç¼ºä¹è¯¦ç»†ä¿¡æ¯

## ğŸ¯ **è§£å†³æ–¹æ¡ˆå»ºè®®**

### **ğŸš€ æ–¹æ¡ˆ1: çœŸæ­£çš„ç®€åŒ–è®¤è¯** (å¼ºçƒˆæ¨è)

**å®ç°æ–‡æ¡£ä¸­æè¿°çš„ç®€åŒ–è®¾è®¡**:

```typescript
// 1. ç®€åŒ–ç™»å½•API
POST /api/simple-auth/login
{
  username: string,
  password: string,
  role: 'reviewer' | 'admin' | 'super_admin'
}

// 2. è¿”å›ç®€å•JWT
{
  success: true,
  token: "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
  user: { id, username, role }
}

// 3. ç®€åŒ–æƒé™éªŒè¯
const verifyJWT = (token) => {
  const payload = jwt.verify(token, SECRET);
  return payload;
};
```

### **ğŸ”§ æ–¹æ¡ˆ2: ä¿®å¤å½“å‰ç³»ç»Ÿ** (å¤‡é€‰)

**å¦‚æœå¿…é¡»ä¿æŒå½“å‰æ¶æ„**:

1. **ä¿®å¤æ•°æ®åº“è¡¨ç»“æ„**
2. **å®Œå–„é”™è¯¯å¤„ç†å’Œæ—¥å¿—**
3. **ç®€åŒ–æƒé™éªŒè¯ä¸­é—´ä»¶**
4. **æ·»åŠ è¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯**

### **ğŸ“Š æ–¹æ¡ˆå¯¹æ¯”**

| æ–¹æ¡ˆ | å®æ–½æ—¶é—´ | é£é™© | é•¿æœŸç»´æŠ¤ | æ¨èåº¦ |
|------|---------|------|----------|--------|
| çœŸæ­£ç®€åŒ–è®¤è¯ | 4å°æ—¶ | ä½ | ç®€å• | â­â­â­â­â­ |
| ä¿®å¤å½“å‰ç³»ç»Ÿ | 6å°æ—¶ | ä¸­ | å¤æ‚ | â­â­â­ |

## ğŸ¯ **æœ€ç»ˆå»ºè®®**

**reviewer-admin-dashboard çš„è®¤è¯ç³»ç»Ÿç¡®å®ä¸åˆç†ï¼Œä¸»è¦é—®é¢˜æ˜¯ï¼š**

1. **è®¾è®¡ä¸å®ç°ä¸¥é‡ä¸ç¬¦**: æ–‡æ¡£æè¿°ç®€åŒ–ï¼Œå®é™…å®ç°å¤æ‚
2. **ç›´æ¥å¤ç”¨å¤æ‚ç³»ç»Ÿ**: æ²¡æœ‰å®ç°ç‹¬ç«‹å‰ç«¯çš„ç®€åŒ–ç›®æ ‡
3. **ç»§æ‰¿äº†æ‰€æœ‰åŸç³»ç»Ÿé—®é¢˜**: è®¤è¯é”™è¯¯ã€æ•°æ®åº“ä¾èµ–ã€è°ƒè¯•å›°éš¾

**å»ºè®®ç«‹å³å®æ–½çœŸæ­£çš„ç®€åŒ–è®¤è¯æ–¹æ¡ˆï¼Œå®ç°æ–‡æ¡£ä¸­æè¿°çš„ç†æƒ³æ¶æ„ï¼Œä»æ ¹æœ¬ä¸Šè§£å†³åå¤å‡ºç°çš„è®¤è¯é—®é¢˜ã€‚**
